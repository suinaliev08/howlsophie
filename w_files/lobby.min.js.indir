var LichessLobby=function(){"use strict";const e={Accept:"application/vnd.lichess.v5+json"},t={cache:"no-cache",credentials:"same-origin"},n={"X-Requested-With":"XMLHttpRequest"};function o(e){if(e.ok)return e;if(429==e.status)throw new Error("Too many requests");if(413==e.status)throw new Error("The uploaded file is too large");throw new Error(`Error ${e.status}`)}const i=(i,s={})=>fetch(i,Object.assign(Object.assign(Object.assign({},t),{headers:Object.assign(Object.assign({},e),n)}),s)).then((e=>o(e).json())),s=(e,t={})=>r(e,t).then((e=>o(e).text())),r=(e,o={})=>fetch(e,Object.assign(Object.assign(Object.assign({},t),{headers:Object.assign({},n)}),o)),a=e=>{const t=new FormData;for(const n of Object.keys(e))t.append(n,e[n]);return t};const c={createElement:function(e,t){return document.createElement(e,t)},createElementNS:function(e,t,n){return document.createElementNS(e,t,n)},createTextNode:function(e){return document.createTextNode(e)},createComment:function(e){return document.createComment(e)},insertBefore:function(e,t,n){e.insertBefore(t,n)},removeChild:function(e,t){e.removeChild(t)},appendChild:function(e,t){e.appendChild(t)},parentNode:function(e){return e.parentNode},nextSibling:function(e){return e.nextSibling},tagName:function(e){return e.tagName},setTextContent:function(e,t){e.textContent=t},getTextContent:function(e){return e.textContent},isElement:function(e){return 1===e.nodeType},isText:function(e){return 3===e.nodeType},isComment:function(e){return 8===e.nodeType}};function l(e,t,n,o,i){return{sel:e,data:t,children:n,text:o,elm:i,key:void 0===t?void 0:t.key}}const d=Array.isArray;function u(e){return"string"==typeof e||"number"==typeof e}function h(e){return void 0===e}function p(e){return void 0!==e}const f=l("",{},[],void 0,void 0);function g(e,t){var n,o;const i=e.key===t.key,s=(null===(n=e.data)||void 0===n?void 0:n.is)===(null===(o=t.data)||void 0===o?void 0:o.is);return e.sel===t.sel&&i&&s}function m(e,t,n){var o;const i={};for(let s=t;s<=n;++s){const t=null===(o=e[s])||void 0===o?void 0:o.key;void 0!==t&&(i[t]=s)}return i}const v=["create","update","remove","destroy","pre","post"];function b(e,t,n){if(e.ns="http://www.w3.org/2000/svg","foreignObject"!==n&&void 0!==t)for(let o=0;o<t.length;++o){const e=t[o].data;void 0!==e&&b(e,t[o].children,t[o].sel)}}function k(e,t,n){let o,i,s,r={};if(void 0!==n?(null!==t&&(r=t),d(n)?o=n:u(n)?i=n:n&&n.sel&&(o=[n])):null!=t&&(d(t)?o=t:u(t)?i=t:t&&t.sel?o=[t]:r=t),void 0!==o)for(s=0;s<o.length;++s)u(o[s])&&(o[s]=l(void 0,void 0,void 0,o[s],void 0));return"s"!==e[0]||"v"!==e[1]||"g"!==e[2]||3!==e.length&&"."!==e[3]&&"#"!==e[3]||b(r,o,e),l(e,r,o,i,void 0)}function w(e,t){let n;const o=t.elm;let i=e.data.attrs,s=t.data.attrs;if((i||s)&&i!==s){for(n in i=i||{},s=s||{},s){const e=s[n];i[n]!==e&&(!0===e?o.setAttribute(n,""):!1===e?o.removeAttribute(n):120!==n.charCodeAt(0)?o.setAttribute(n,e):58===n.charCodeAt(3)?o.setAttributeNS("http://www.w3.org/XML/1998/namespace",n,e):58===n.charCodeAt(5)?o.setAttributeNS("http://www.w3.org/1999/xlink",n,e):o.setAttribute(n,e))}for(n in i)n in s||o.removeAttribute(n)}}const y={create:w,update:w};function C(e,t){let n,o;const i=t.elm;let s=e.data.class,r=t.data.class;if((s||r)&&s!==r){for(o in s=s||{},r=r||{},s)s[o]&&!Object.prototype.hasOwnProperty.call(r,o)&&i.classList.remove(o);for(o in r)n=r[o],n!==s[o]&&i.classList[n?"add":"remove"](o)}}const T={create:C,update:C},x=["white","black"],M=["a","b","c","d","e","f","g","h"],S=["1","2","3","4","5","6","7","8"],_=[...S].reverse(),P=Array.prototype.concat(...M.map((e=>S.map((t=>e+t))))),A=e=>P[8*e[0]+e[1]],O=e=>[e.charCodeAt(0)-97,e.charCodeAt(1)-49],I=P.map(O);const L=()=>{let e;return{start(){e=performance.now()},cancel(){e=void 0},stop(){if(!e)return 0;const t=performance.now()-e;return e=void 0,t}}},j=e=>"white"===e?"black":"white",H=(e,t)=>{const n=e[0]-t[0],o=e[1]-t[1];return n*n+o*o},N=(e,t)=>e.role===t.role&&e.color===t.color,E=e=>(t,n)=>[(n?t[0]:7-t[0])*e.width/8,(n?7-t[1]:t[1])*e.height/8],B=(e,t)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px)`},R=(e,t)=>{e.style.visibility=t?"visible":"hidden"},D=e=>{var t;return e.clientX||0===e.clientX?[e.clientX,e.clientY]:(null===(t=e.targetTouches)||void 0===t?void 0:t[0])?[e.targetTouches[0].clientX,e.targetTouches[0].clientY]:void 0},F=e=>2===e.buttons||2===e.button,K=(e,t)=>{const n=document.createElement(e);return t&&(n.className=t),n};function q(e,t,n){const o=O(e);return t||(o[0]=7-o[0],o[1]=7-o[1]),[n.left+n.width*o[0]/8+n.width/16,n.top+n.height*(7-o[1])/8+n.height/16]}function z(e,t){return Math.abs(e-t)}const W=(e,t,n,o)=>{const i=z(e,n),s=z(t,o);return 1===i&&2===s||2===i&&1===s},V=(e,t,n,o)=>z(e,n)===z(t,o),G=(e,t,n,o)=>e===n||t===o,U=(e,t,n,o)=>V(e,t,n,o)||G(e,t,n,o);function X(e,t,n){const o=e.get(t);if(!o)return[];const i=O(t),s=o.role,r="pawn"===s?(a=o.color,(e,t,n,o)=>z(e,n)<2&&("white"===a?o===t+1||t<=1&&o===t+2&&e===n:o===t-1||t>=6&&o===t-2&&e===n)):"knight"===s?W:"bishop"===s?V:"rook"===s?G:"queen"===s?U:function(e,t,n){return(o,i,s,r)=>z(o,s)<2&&z(i,r)<2||n&&i===r&&i===("white"===e?0:7)&&(4===o&&(2===s&&t.includes(0)||6===s&&t.includes(7))||t.includes(s))}(o.color,function(e,t){const n="white"===t?"1":"8",o=[];for(const[i,s]of e)i[1]===n&&s.color===t&&"rook"===s.role&&o.push(O(i)[0]);return o}(e,o.color),n);var a;return I.filter((e=>(i[0]!==e[0]||i[1]!==e[1])&&r(i[0],i[1],e[0],e[1]))).map(A)}function Y(e,...t){e&&setTimeout((()=>e(...t)),1)}function Z(e){e.premovable.current&&(e.premovable.current=void 0,Y(e.premovable.events.unset))}function J(e){const t=e.predroppable;t.current&&(t.current=void 0,Y(t.events.unset))}function Q(e,t,n){const o=e.pieces.get(t),i=e.pieces.get(n);if(t===n||!o)return!1;const s=i&&i.color!==o.color?i:void 0;return n===e.selected&&re(e),Y(e.events.move,t,n,s),function(e,t,n){if(!e.autoCastle)return!1;const o=e.pieces.get(t);if(!o||"king"!==o.role)return!1;const i=O(t),s=O(n);if(0!==i[1]&&7!==i[1]||i[1]!==s[1])return!1;4!==i[0]||e.pieces.has(n)||(6===s[0]?n=A([7,s[1]]):2===s[0]&&(n=A([0,s[1]])));const r=e.pieces.get(n);return!(!r||r.color!==o.color||"rook"!==r.role||(e.pieces.delete(t),e.pieces.delete(n),i[0]<s[0]?(e.pieces.set(A([6,s[1]]),o),e.pieces.set(A([5,s[1]]),r)):(e.pieces.set(A([2,s[1]]),o),e.pieces.set(A([3,s[1]]),r)),0))}(e,t,n)||(e.pieces.set(n,o),e.pieces.delete(t)),e.lastMove=[t,n],e.check=void 0,Y(e.events.change),s||!0}function ee(e,t,n,o){if(e.pieces.has(n)){if(!o)return!1;e.pieces.delete(n)}return Y(e.events.dropNewPiece,t,n),e.pieces.set(n,t),e.lastMove=[n],e.check=void 0,Y(e.events.change),e.movable.dests=void 0,e.turnColor=j(e.turnColor),!0}function te(e,t,n){const o=Q(e,t,n);return o&&(e.movable.dests=void 0,e.turnColor=j(e.turnColor),e.animation.current=void 0),o}function ne(e,t,n){if(ce(e,t,n)){const o=te(e,t,n);if(o){const i=e.hold.stop();re(e);const s={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:i};return!0!==o&&(s.captured=o),Y(e.movable.events.after,t,n,s),!0}}else if(function(e,t,n){return t!==n&&le(e,t)&&X(e.pieces,t,e.premovable.castle).includes(n)}(e,t,n))return function(e,t,n,o){J(e),e.premovable.current=[t,n],Y(e.premovable.events.set,t,n,o)}(e,t,n,{ctrlKey:e.stats.ctrlKey}),re(e),!0;return re(e),!1}function oe(e,t,n,o){const i=e.pieces.get(t);i&&(function(e,t,n){const o=e.pieces.get(t);return!(!o||t!==n&&e.pieces.has(n)||"both"!==e.movable.color&&(e.movable.color!==o.color||e.turnColor!==o.color))}(e,t,n)||o)?(e.pieces.delete(t),ee(e,i,n,o),Y(e.movable.events.afterNewPiece,i.role,n,{premove:!1,predrop:!1})):i&&function(e,t,n){const o=e.pieces.get(t),i=e.pieces.get(n);return!!o&&(!i||i.color!==e.movable.color)&&e.predroppable.enabled&&("pawn"!==o.role||"1"!==n[1]&&"8"!==n[1])&&e.movable.color===o.color&&e.turnColor!==o.color}(e,t,n)?function(e,t,n){Z(e),e.predroppable.current={role:t,key:n},Y(e.predroppable.events.set,t,n)}(e,i.role,n):(Z(e),J(e)),e.pieces.delete(t),re(e)}function ie(e,t,n){if(Y(e.events.select,t),e.selected){if(e.selected===t&&!e.draggable.enabled)return re(e),void e.hold.cancel();if((e.selectable.enabled||n)&&e.selected!==t&&ne(e,e.selected,t))return void(e.stats.dragged=!1)}(ae(e,t)||le(e,t))&&(se(e,t),e.hold.start())}function se(e,t){e.selected=t,le(e,t)?e.premovable.dests=X(e.pieces,t,e.premovable.castle):e.premovable.dests=void 0}function re(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function ae(e,t){const n=e.pieces.get(t);return!!n&&("both"===e.movable.color||e.movable.color===n.color&&e.turnColor===n.color)}function ce(e,t,n){var o,i;return t!==n&&ae(e,t)&&(e.movable.free||!!(null===(i=null===(o=e.movable.dests)||void 0===o?void 0:o.get(t))||void 0===i?void 0:i.includes(n)))}function le(e,t){const n=e.pieces.get(t);return!!n&&e.premovable.enabled&&e.movable.color===n.color&&e.turnColor!==n.color}function de(e){const t=e.premovable.current;if(!t)return!1;const n=t[0],o=t[1];let i=!1;if(ce(e,n,o)){const t=te(e,n,o);if(t){const s={premove:!0};!0!==t&&(s.captured=t),Y(e.movable.events.after,n,o,s),i=!0}}return Z(e),i}function ue(e){Z(e),J(e),re(e)}function he(e){e.movable.color=e.movable.dests=e.animation.current=void 0,ue(e)}function pe(e,t,n){let o=Math.floor(8*(e[0]-n.left)/n.width);t||(o=7-o);let i=7-Math.floor(8*(e[1]-n.top)/n.height);return t||(i=7-i),o>=0&&o<8&&i>=0&&i<8?A([o,i]):void 0}function fe(e){return"white"===e.orientation}const ge="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",me={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},ve={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};function be(e){"start"===e&&(e=ge);const t=new Map;let n=7,o=0;for(const i of e)switch(i){case" ":return t;case"/":if(--n,n<0)return t;o=0;break;case"~":{const e=t.get(A([o,n]));e&&(e.promoted=!0);break}default:{const e=i.charCodeAt(0);if(e<57)o+=e-48;else{const e=i.toLowerCase();t.set(A([o,n]),{role:me[e],color:i===e?"black":"white"}),++o}}}return t}function ke(e,t){t.animation&&(ye(e.animation,t.animation),(e.animation.duration||0)<70&&(e.animation.enabled=!1))}function we(e,t){var n,o;if((null===(n=t.movable)||void 0===n?void 0:n.dests)&&(e.movable.dests=void 0),(null===(o=t.drawable)||void 0===o?void 0:o.autoShapes)&&(e.drawable.autoShapes=[]),ye(e,t),t.fen&&(e.pieces=be(t.fen),e.drawable.shapes=[]),"check"in t&&function(e,t){if(e.check=void 0,!0===t&&(t=e.turnColor),t)for(const[n,o]of e.pieces)"king"===o.role&&o.color===t&&(e.check=n)}(e,t.check||!1),"lastMove"in t&&!t.lastMove?e.lastMove=void 0:t.lastMove&&(e.lastMove=t.lastMove),e.selected&&se(e,e.selected),ke(e,t),!e.movable.rookCastle&&e.movable.dests){const t="white"===e.movable.color?"1":"8",n="e"+t,o=e.movable.dests.get(n),i=e.pieces.get(n);if(!o||!i||"king"!==i.role)return;e.movable.dests.set(n,o.filter((e=>!(e==="a"+t&&o.includes("c"+t)||e==="h"+t&&o.includes("g"+t)))))}}function ye(e,t){for(const n in t)Ce(e[n])&&Ce(t[n])?ye(e[n],t[n]):e[n]=t[n]}function Ce(e){return"object"==typeof e}function Te(e,t){return t.animation.enabled?function(e,t){const n=new Map(t.pieces),o=e(t),i=function(e,t){const n=new Map,o=[],i=new Map,s=[],r=[],a=new Map;let c,l,d;for(const[u,h]of e)a.set(u,Me(u,h));for(const u of P)c=t.pieces.get(u),l=a.get(u),c?l?N(c,l.piece)||(s.push(l),r.push(Me(u,c))):r.push(Me(u,c)):l&&s.push(l);for(const u of r)l=Se(u,s.filter((e=>N(u.piece,e.piece)))),l&&(d=[l.pos[0]-u.pos[0],l.pos[1]-u.pos[1]],n.set(u.key,d.concat(d)),o.push(l.key));for(const u of s)o.includes(u.key)||i.set(u.key,u.piece);return{anims:n,fadings:i}}(n,t);if(i.anims.size||i.fadings.size){const e=t.animation.current&&t.animation.current.start;t.animation.current={start:performance.now(),frequency:1/t.animation.duration,plan:i},e||_e(t,performance.now())}else t.dom.redraw();return o}(e,t):xe(e,t)}function xe(e,t){const n=e(t);return t.dom.redraw(),n}function Me(e,t){return{key:e,pos:O(e),piece:t}}function Se(e,t){return t.sort(((t,n)=>H(e.pos,t.pos)-H(e.pos,n.pos)))[0]}function _e(e,t){const n=e.animation.current;if(void 0===n)return void(e.dom.destroyed||e.dom.redrawNow());const o=1-(t-n.start)*n.frequency;if(o<=0)e.animation.current=void 0,e.dom.redrawNow();else{const t=(i=o)<.5?4*i*i*i:(i-1)*(2*i-2)*(2*i-2)+1;for(const e of n.plan.anims.values())e[2]=e[0]*t,e[3]=e[1]*t;e.dom.redrawNow(!0),requestAnimationFrame(((t=performance.now())=>_e(e,t)))}var i}const Pe=["green","red","blue","yellow"];function Ae(e,t){if(t.touches&&t.touches.length>1)return;t.stopPropagation(),t.preventDefault(),t.ctrlKey?re(e):ue(e);const n=D(t),o=pe(n,fe(e),e.dom.bounds());o&&(e.drawable.current={orig:o,pos:n,brush:je(t),snapToValidMove:e.drawable.defaultSnapToValidMove},$e(e))}function $e(e){requestAnimationFrame((()=>{const t=e.drawable.current;if(t){const n=pe(t.pos,fe(e),e.dom.bounds());n||(t.snapToValidMove=!1);const o=t.snapToValidMove?function(e,t,n,o){const i=O(e),s=I.filter((e=>U(i[0],i[1],e[0],e[1])||W(i[0],i[1],e[0],e[1]))),r=s.map((e=>q(A(e),n,o))).map((e=>H(t,e))),[,a]=r.reduce(((e,t,n)=>e[0]<t?e:[t,n]),[r[0],0]);return A(s[a])}(t.orig,t.pos,fe(e),e.dom.bounds()):n;o!==t.mouseSq&&(t.mouseSq=o,t.dest=o!==t.orig?o:void 0,e.dom.redrawNow()),$e(e)}}))}function Oe(e,t){e.drawable.current&&(e.drawable.current.pos=D(t))}function Ie(e){const t=e.drawable.current;t&&(t.mouseSq&&function(e,t){const n=e=>e.orig===t.orig&&e.dest===t.dest,o=e.shapes.find(n);o&&(e.shapes=e.shapes.filter((e=>!n(e))));o&&o.brush===t.brush||e.shapes.push(t);He(e)}(e.drawable,t),Le(e))}function Le(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function je(e){var t;const n=(e.shiftKey||e.ctrlKey)&&F(e),o=e.altKey||e.metaKey||(null===(t=e.getModifierState)||void 0===t?void 0:t.call(e,"AltGraph"));return Pe[(n?1:0)+(o?2:0)]}function He(e){e.onChange&&e.onChange(e.shapes)}function Ne(e,t){if(!t.isTrusted||void 0!==t.button&&0!==t.button)return;if(t.touches&&t.touches.length>1)return;const n=e.dom.bounds(),o=D(t),i=pe(o,fe(e),n);if(!i)return;const s=e.pieces.get(i),r=e.selected;var a;r||!e.drawable.enabled||!e.drawable.eraseOnClick&&s&&s.color===e.turnColor||(a=e).drawable.shapes.length&&(a.drawable.shapes=[],a.dom.redraw(),He(a.drawable)),!1!==t.cancelable&&(!t.touches||e.blockTouchScroll||s||r||function(e,t){const n=fe(e),o=e.dom.bounds(),i=Math.pow(o.width/8,2);for(const s of e.pieces.keys()){const e=q(s,n,o);if(H(e,t)<=i)return!0}return!1}(e,o))&&t.preventDefault();const c=!!e.premovable.current,l=!!e.predroppable.current;e.stats.ctrlKey=t.ctrlKey,e.selected&&ce(e,e.selected,i)?Te((e=>ie(e,i)),e):ie(e,i);const d=e.selected===i,u=Ke(e,i);if(s&&u&&d&&function(e,t){const n=e.pieces.get(t);return!!n&&e.draggable.enabled&&("both"===e.movable.color||e.movable.color===n.color&&(e.turnColor===n.color||e.premovable.enabled))}(e,i)){e.draggable.current={orig:i,piece:s,origPos:o,pos:o,started:e.draggable.autoDistance&&e.stats.dragged,element:u,previouslySelected:r,originTarget:t.target,keyHasChanged:!1},u.cgDragging=!0,u.classList.add("dragging");const a=e.dom.elements.ghost;a&&(a.className=`ghost ${s.color} ${s.role}`,B(a,E(n)(O(i),fe(e))),R(a,!0)),Ee(e)}else c&&Z(e),l&&J(e);e.dom.redraw()}function Ee(e){requestAnimationFrame((()=>{var t;const n=e.draggable.current;if(!n)return;(null===(t=e.animation.current)||void 0===t?void 0:t.plan.anims.has(n.orig))&&(e.animation.current=void 0);const o=e.pieces.get(n.orig);if(o&&N(o,n.piece)){if(!n.started&&H(n.pos,n.origPos)>=Math.pow(e.draggable.distance,2)&&(n.started=!0),n.started){if("function"==typeof n.element){const e=n.element();if(!e)return;e.cgDragging=!0,e.classList.add("dragging"),n.element=e}const t=e.dom.bounds();B(n.element,[n.pos[0]-t.left-t.width/16,n.pos[1]-t.top-t.height/16]),n.keyHasChanged||(n.keyHasChanged=n.orig!==pe(n.pos,fe(e),t))}}else De(e);Ee(e)}))}function Be(e,t){e.draggable.current&&(!t.touches||t.touches.length<2)&&(e.draggable.current.pos=D(t))}function Re(e,t){const n=e.draggable.current;if(!n)return;if("touchend"===t.type&&!1!==t.cancelable&&t.preventDefault(),"touchend"===t.type&&n.originTarget!==t.target&&!n.newPiece)return void(e.draggable.current=void 0);Z(e),J(e);const o=pe(D(t)||n.pos,fe(e),e.dom.bounds());o&&n.started&&n.orig!==o?n.newPiece?oe(e,n.orig,o,n.force):(e.stats.ctrlKey=t.ctrlKey,ne(e,n.orig,o)&&(e.stats.dragged=!0)):n.newPiece?e.pieces.delete(n.orig):e.draggable.deleteOnDropOff&&!o&&(e.pieces.delete(n.orig),Y(e.events.change)),(n.orig!==n.previouslySelected&&!n.keyHasChanged||n.orig!==o&&o)&&e.selectable.enabled||re(e),Fe(e),e.draggable.current=void 0,e.dom.redraw()}function De(e){const t=e.draggable.current;t&&(t.newPiece&&e.pieces.delete(t.orig),e.draggable.current=void 0,re(e),Fe(e),e.dom.redraw())}function Fe(e){const t=e.dom.elements;t.ghost&&R(t.ghost,!1)}function Ke(e,t){let n=e.dom.elements.board.firstChild;for(;n;){if(n.cgKey===t&&"PIECE"===n.tagName)return n;n=n.nextSibling}}function qe(e,t){e.exploding&&(t?e.exploding.stage=t:e.exploding=void 0,e.dom.redraw())}function ze(e,t){function n(){!function(e){e.orientation=j(e.orientation),e.animation.current=e.draggable.current=e.selected=void 0}(e),t()}return{set(t){t.orientation&&t.orientation!==e.orientation&&n(),ke(e,t),(t.fen?Te:xe)((e=>we(e,t)),e)},state:e,getFen:()=>{return t=e.pieces,_.map((e=>M.map((n=>{const o=t.get(n+e);if(o){const e=ve[o.role];return"white"===o.color?e.toUpperCase():e}return"1"})).join(""))).join("/").replace(/1{2,}/g,(e=>e.length.toString()));var t},toggleOrientation:n,setPieces(t){Te((e=>function(e,t){for(const[n,o]of t)o?e.pieces.set(n,o):e.pieces.delete(n)}(e,t)),e)},selectSquare(t,n){t?Te((e=>ie(e,t,n)),e):e.selected&&(re(e),e.dom.redraw())},move(t,n){Te((e=>Q(e,t,n)),e)},newPiece(t,n){Te((e=>ee(e,t,n)),e)},playPremove(){if(e.premovable.current){if(Te(de,e))return!0;e.dom.redraw()}return!1},playPredrop(t){if(e.predroppable.current){const n=function(e,t){const n=e.predroppable.current;let o=!1;if(!n)return!1;t(n)&&ee(e,{role:n.role,color:e.movable.color},n.key)&&(Y(e.movable.events.afterNewPiece,n.role,n.key,{premove:!1,predrop:!0}),o=!0);return J(e),o}(e,t);return e.dom.redraw(),n}return!1},cancelPremove(){xe(Z,e)},cancelPredrop(){xe(J,e)},cancelMove(){xe((e=>{ue(e),De(e)}),e)},stop(){xe((e=>{he(e),De(e)}),e)},explode(t){!function(e,t){e.exploding={stage:1,keys:t},e.dom.redraw(),setTimeout((()=>{qe(e,2),setTimeout((()=>qe(e,void 0)),120)}),120)}(e,t)},setAutoShapes(t){xe((e=>e.drawable.autoShapes=t),e)},setShapes(t){xe((e=>e.drawable.shapes=t),e)},getKeyAtDomPos:t=>pe(t,fe(e),e.dom.bounds()),redrawAll:t,dragNewPiece(t,n,o){!function(e,t,n,o){const i="a0";e.pieces.set(i,t),e.dom.redraw();const s=D(n);e.draggable.current={orig:i,piece:t,origPos:s,pos:s,started:!0,element:()=>Ke(e,i),originTarget:n.target,newPiece:!0,force:!!o,keyHasChanged:!1},Ee(e)}(e,t,n,o)},destroy(){he(e),e.dom.unbind&&e.dom.unbind(),e.dom.destroyed=!0}}}function We(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function Ve(e,t,n){const o=e.drawable,i=o.current,s=i&&i.mouseSq?i:void 0,r=new Map,a=e.dom.bounds();for(const p of o.shapes.concat(o.autoShapes).concat(s?[s]:[]))p.dest&&r.set(p.dest,(r.get(p.dest)||0)+1);const c=o.shapes.concat(o.autoShapes).map((e=>({shape:e,current:!1,hash:Ue(e,r,!1,a)})));s&&c.push({shape:s,current:!0,hash:Ue(s,r,!0,a)});const l=c.map((e=>e.hash)).join(";");if(l===e.drawable.prevSvgHash)return;e.drawable.prevSvgHash=l;const d=t.querySelector("defs"),u=t.querySelector("g"),h=n.querySelector("g");!function(e,t,n){const o=new Map;let i;for(const a of t)a.shape.dest&&(i=e.brushes[a.shape.brush],a.shape.modifiers&&(i=tt(i,a.shape.modifiers)),o.set(i.key,i));const s=new Set;let r=n.firstChild;for(;r;)s.add(r.getAttribute("cgKey")),r=r.nextSibling;for(const[a,c]of o.entries())s.has(a)||n.appendChild(Je(c))}(o,c,d),Ge(e,c.filter((e=>!e.shape.customSvg)),o.brushes,r,u),Ge(e,c.filter((e=>e.shape.customSvg)),o.brushes,r,h)}function Ge(e,t,n,o,i){const s=e.dom.bounds(),r=new Map,a=[];for(const d of t)r.set(d.hash,!1);let c,l=i.firstChild;for(;l;)c=l.getAttribute("cgHash"),r.has(c)?r.set(c,!0):a.push(l),l=l.nextSibling;for(const d of a)i.removeChild(d);for(const d of t)r.get(d.hash)||i.appendChild(Ze(e,d,n,o,s))}function Ue({orig:e,dest:t,brush:n,piece:o,modifiers:i,customSvg:s},r,a,c){return[c.width,c.height,a,e,t,n,t&&(r.get(t)||0)>1,o&&Xe(o),i&&(l=i,""+(l.lineWidth||"")),s&&Ye(s)].filter((e=>e)).join(",");var l}function Xe(e){return[e.color,e.role,e.scale].filter((e=>e)).join(",")}function Ye(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n)>>>0;return"custom-"+t.toString()}function Ze(e,{shape:t,current:n,hash:o},i,s,r){let a;if(t.customSvg){const n=et(O(t.orig),e.orientation);a=function(e,t,n){const[o,i]=it(t,n),s=Qe(We("g"),{transform:`translate(${o},${i})`}),r=Qe(We("svg"),{width:1,height:1,viewBox:"0 0 100 100"});return s.appendChild(r),r.innerHTML=e,s}(t.customSvg,n,r)}else if(t.piece)a=function(e,t,n,o){const i=it(t,o),s=n.color[0]+("knight"===n.role?"n":n.role[0]).toUpperCase();return Qe(We("image"),{className:`${n.role} ${n.color}`,x:i[0]-.5,y:i[1]-.5,width:1,height:1,href:e+s+".svg",transform:`scale(${n.scale||1})`,"transform-origin":`${i[0]} ${i[1]}`})}(e.drawable.pieces.baseUrl,et(O(t.orig),e.orientation),t.piece,r);else{const o=et(O(t.orig),e.orientation);if(t.dest){let c=i[t.brush];t.modifiers&&(c=tt(c,t.modifiers)),a=function(e,t,n,o,i,s){const r=function(e){return(e?20:10)/64}(i&&!o),a=it(t,s),c=it(n,s),l=c[0]-a[0],d=c[1]-a[1],u=Math.atan2(d,l),h=Math.cos(u)*r,p=Math.sin(u)*r;return Qe(We("line"),{stroke:e.color,"stroke-width":nt(e,o),"stroke-linecap":"round","marker-end":"url(#arrowhead-"+e.key+")",opacity:ot(e,o),x1:a[0],y1:a[1],x2:c[0]-h,y2:c[1]-p})}(c,o,et(O(t.dest),e.orientation),n,(s.get(t.dest)||0)>1,r)}else a=function(e,t,n,o){const i=it(t,o),s=[3/64,4/64],r=(o.width+o.height)/(4*Math.max(o.width,o.height));return Qe(We("circle"),{stroke:e.color,"stroke-width":s[n?0:1],fill:"none",opacity:ot(e,n),cx:i[0],cy:i[1],r:r-s[1]/2})}(i[t.brush],o,n,r)}return a.setAttribute("cgHash",o),a}function Je(e){const t=Qe(We("marker"),{id:"arrowhead-"+e.key,orient:"auto",markerWidth:4,markerHeight:8,refX:2.05,refY:2.01});return t.appendChild(Qe(We("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),t.setAttribute("cgKey",e.key),t}function Qe(e,t){for(const n in t)e.setAttribute(n,t[n]);return e}function et(e,t){return"white"===t?e:[7-e[0],7-e[1]]}function tt(e,t){return{color:e.color,opacity:Math.round(10*e.opacity)/10,lineWidth:Math.round(t.lineWidth||e.lineWidth),key:[e.key,t.lineWidth].filter((e=>e)).join("")}}function nt(e,t){return(e.lineWidth||10)*(t?.85:1)/64}function ot(e,t){return(e.opacity||1)*(t?.9:1)}function it(e,t){const n=Math.min(1,t.width/t.height),o=Math.min(1,t.height/t.width);return[(e[0]-3.5)*n,(3.5-e[1])*o]}function st(e,t){const n=K("coords",t);let o;for(const i of e)o=K("coord"),o.textContent=i,n.appendChild(o);return n}function rt(e,t){const n=e.dom.elements.board;if("ResizeObserver"in window&&new ResizeObserver(t).observe(e.dom.elements.wrap),e.viewOnly)return;const o=function(e){return t=>{e.draggable.current?De(e):e.drawable.current?Le(e):t.shiftKey||F(t)?e.drawable.enabled&&Ae(e,t):e.viewOnly||(e.dropmode.active?function(e,t){if(!e.dropmode.active)return;Z(e),J(e);const n=e.dropmode.piece;if(n){e.pieces.set("a0",n);const o=D(t),i=o&&pe(o,fe(e),e.dom.bounds());i&&oe(e,"a0",i)}e.dom.redraw()}(e,t):Ne(e,t))}}(e);n.addEventListener("touchstart",o,{passive:!1}),n.addEventListener("mousedown",o,{passive:!1}),(e.disableContextMenu||e.drawable.enabled)&&n.addEventListener("contextmenu",(e=>e.preventDefault()))}function at(e,t,n,o){return e.addEventListener(t,n,o),()=>e.removeEventListener(t,n,o)}function ct(e,t,n){return o=>{e.drawable.current?e.drawable.enabled&&n(e,o):e.viewOnly||t(e,o)}}function lt(e){const t=fe(e),n=E(e.dom.bounds()),o=e.dom.elements.board,i=e.pieces,s=e.animation.current,r=s?s.plan.anims:new Map,a=s?s.plan.fadings:new Map,c=e.draggable.current,l=function(e){var t;const n=new Map;if(e.lastMove&&e.highlight.lastMove)for(const s of e.lastMove)mt(n,s,"last-move");e.check&&e.highlight.check&&mt(n,e.check,"check");if(e.selected&&(mt(n,e.selected,"selected"),e.movable.showDests)){const o=null===(t=e.movable.dests)||void 0===t?void 0:t.get(e.selected);if(o)for(const t of o)mt(n,t,"move-dest"+(e.pieces.has(t)?" oc":""));const i=e.premovable.dests;if(i)for(const t of i)mt(n,t,"premove-dest"+(e.pieces.has(t)?" oc":""))}const o=e.premovable.current;if(o)for(const s of o)mt(n,s,"current-premove");else e.predroppable.current&&mt(n,e.predroppable.current.key,"current-premove");const i=e.exploding;if(i)for(const s of i.keys)mt(n,s,"exploding"+i.stage);return n}(e),d=new Set,u=new Set,h=new Map,p=new Map;let f,g,m,v,b,k,w,y,C,T;for(g=o.firstChild;g;){if(f=g.cgKey,ut(g))if(m=i.get(f),b=r.get(f),k=a.get(f),v=g.cgPiece,!g.cgDragging||c&&c.orig===f||(g.classList.remove("dragging"),B(g,n(O(f),t)),g.cgDragging=!1),!k&&g.cgFading&&(g.cgFading=!1,g.classList.remove("fading")),m){if(b&&g.cgAnimating&&v===gt(m)){const e=O(f);e[0]+=b[2],e[1]+=b[3],g.classList.add("anim"),B(g,n(e,t))}else g.cgAnimating&&(g.cgAnimating=!1,g.classList.remove("anim"),B(g,n(O(f),t)),e.addPieceZIndex&&(g.style.zIndex=ft(O(f),t)));v!==gt(m)||k&&g.cgFading?k&&v===gt(k)?(g.classList.add("fading"),g.cgFading=!0):vt(h,v,g):d.add(f)}else vt(h,v,g);else if(ht(g)){const e=g.className;l.get(f)===e?u.add(f):vt(p,e,g)}g=g.nextSibling}for(const[x,M]of l)if(!u.has(x)){C=p.get(M),T=C&&C.pop();const e=n(O(x),t);if(T)T.cgKey=x,B(T,e);else{const t=K("square",M);t.cgKey=x,B(t,e),o.insertBefore(t,o.firstChild)}}for(const[x,M]of i)if(b=r.get(x),!d.has(x))if(w=h.get(gt(M)),y=w&&w.pop(),y){y.cgKey=x,y.cgFading&&(y.classList.remove("fading"),y.cgFading=!1);const o=O(x);e.addPieceZIndex&&(y.style.zIndex=ft(o,t)),b&&(y.cgAnimating=!0,y.classList.add("anim"),o[0]+=b[2],o[1]+=b[3]),B(y,n(o,t))}else{const i=gt(M),s=K("piece",i),r=O(x);s.cgPiece=i,s.cgKey=x,b&&(s.cgAnimating=!0,r[0]+=b[2],r[1]+=b[3]),B(s,n(r,t)),e.addPieceZIndex&&(s.style.zIndex=ft(r,t)),o.appendChild(s)}for(const x of h.values())pt(e,x);for(const x of p.values())pt(e,x)}function dt(e){const t=e.dom.elements.wrap.getBoundingClientRect(),n=e.dom.elements.container,o=t.height/t.width,i=8*Math.floor(t.width*window.devicePixelRatio/8)/window.devicePixelRatio,s=i*o;n.style.width=i+"px",n.style.height=s+"px",e.dom.bounds.clear(),e.addDimensionsCssVars&&(document.documentElement.style.setProperty("--cg-width",i+"px"),document.documentElement.style.setProperty("--cg-height",s+"px"))}function ut(e){return"PIECE"===e.tagName}function ht(e){return"SQUARE"===e.tagName}function pt(e,t){for(const n of t)e.dom.elements.board.removeChild(n)}function ft(e,t){let n=3+8*e[1]+(7-e[0]);return t&&(n=69-n),n+""}function gt(e){return`${e.color} ${e.role}`}function mt(e,t,n){const o=e.get(t);o?e.set(t,`${o} ${n}`):e.set(t,n)}function vt(e,t,n){const o=e.get(t);o?o.push(n):e.set(t,[n])}function bt(e){let t=!1;return()=>{t||(t=!0,requestAnimationFrame((()=>{e(),t=!1})))}}const kt={chess960:"This is a Chess960 game!\n\nThe starting position of the pieces on the players' home ranks is randomized.",kingOfTheHill:"This is a King of the Hill game!\n\nThe game can be won by bringing the king to the center.",threeCheck:"This is a Three-check game!\n\nThe game can be won by checking the opponent three times.",antichess:"This is an Antichess game!\n\nIf you can take a piece, you must. The game can be won by losing all your pieces, or by being stalemated.",atomic:"This is an Atomic chess game!\n\nCapturing a piece causes an explosion, taking out your piece and surrounding non-pawns. Win by mating or exploding your opponent's king.",horde:"This is a Horde chess game!\nBlack must take all White pawns to win. White must checkmate the Black king.",racingKings:"This is a Racing Kings game!\n\nPlayers must race their kings to the eighth rank. Checks are not allowed.",crazyhouse:"This is a Crazyhouse game!\n\nEvery time a piece is captured, the capturing player gets a piece of the same type and of their color in their pocket."},wt=e=>"lobby.variant."+e;function yt(e){return!e||Object.keys(kt).every((function(t){if(e!==t||lichess.storage.get(wt(t)))return!0;{const e=confirm(kt[t]);return e&&lichess.storage.set(wt(t),"1"),e}}))}function Ct(e,t){return(e.rating||0)>(t.rating||0)?-1:1}function Tt(e,t){return e.t<t.t?-1:1}function xt(e,t){t.sort("time"===e.sort?Tt:Ct)}function Mt(e){e.action=e.sri===lichess.sri?"cancel":"join",e.variant=e.variant||"standard"}function St(e){e.data.hooks.forEach(Mt)}function _t(e,t){return e.rating>t.rating?-1:1}function Pt(e){e.data.seeks.forEach((function(t){t.action=e.data.me&&t.username===e.data.me.username?"cancelSeek":"joinSeek"})),function(e){e.data.seeks.sort(_t)}(e)}const At={key:"lobby.tab",fix:e=>e||"pools"},$t={key:"lobby.mode",fix:e=>e||"list"},Ot={key:"lobby.sort",fix:e=>e||"rating"};function It(e,t){const n=e.key+":"+(t||"-");return{set(t){const o=e.fix(t);return lichess.storage.set(n,""+o),o},get:()=>e.fix(lichess.storage.get(n))}}function Lt(e){return"function"==typeof e?e():e}function jt(){var e={};return e.promise=new Promise((function(t,n){e.resolve=t,e.reject=n})),e}const Ht=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=void 0,i=void 0,s=void 0,r=[];return function(){var c=Lt(t),l=(new Date).getTime(),d=!o||l-o>c;o=l;for(var u=arguments.length,h=Array(u),p=0;p<u;p++)h[p]=arguments[p];if(d&&n.leading)return n.accumulate?Promise.resolve(e.call(this,[h])).then((function(e){return e[0]})):Promise.resolve(e.call.apply(e,[this].concat(h)));if(i?clearTimeout(s):i=jt(),r.push(h),s=setTimeout(a.bind(this),c),n.accumulate){var f=r.length-1;return i.promise.then((function(e){return e[f]}))}return i.promise};function a(){var t=i;clearTimeout(s),Promise.resolve(n.accumulate?e.call(this,r):e.apply(this,r[r.length-1])).then(t.resolve,t.reject),r=[],i=null}}((()=>i("/lobby/seeks")),2e3);function Nt(e){return"lobby-pool-range-"+e}class Et{constructor(e,t){this.send=e,this.receive=(e,t)=>!!this.handlers[e]&&(this.handlers[e](t),!0),this.send=e,this.handlers={had(e){!function(e,t){Mt(t),e.data.hooks.push(t)}(t,e),"cancel"===e.action&&t.flushHooks(!0),t.redraw()},hrm(e){e.match(/.{8}/g).forEach((function(e){!function(e,t){e.data.hooks=e.data.hooks.filter((e=>e.id!==t)),e.stepHooks.forEach((e=>{e.id===t&&(e.disabled=!0)}))}(t,e)})),t.redraw()},hooks(e){!function(e,t){e.data.hooks=t,St(e)}(t,e),t.flushHooks(!0),t.redraw()},hli(e){!function(e,t){e.data.hooks=e.data.hooks.filter((e=>t.includes(e.id)))}(t,e.match(/.{8}/g)||[]),t.redraw()},reload_seeks(){"seeks"===t.tab&&Ht().then(t.setSeeks)}},lichess.idleTimer(18e4,(()=>e("idle",!0)),(()=>{e("idle",!1),t.awake()}))}realTimeIn(){this.send("hookIn")}realTimeOut(){this.send("hookOut")}poolIn(e){this.send("poolIn",e,{},!0)}poolOut(e){this.send("poolOut",e.id)}}const Bt=e=>Array.from(new FormData(e).entries()).filter((([e,t])=>!e.includes("_range"))).reduce(((e,[t,n])=>Object.assign(Object.assign({},e),{[t]:n})),{}),Rt=e=>({get:()=>JSON.parse(e.get()||"null"),set:t=>e.set(JSON.stringify(t)),remove:()=>e.remove()});class Dt{constructor(e,t){this.root=t,this.open=!1,this.toggle=()=>{this.open=!this.open},this.set=e=>{var t;this.data=e&&{form:e,filter:(t=e,Object.keys(t).reduce(((e,n)=>{const o=n.indexOf("["),i=o>0?n.slice(0,o):n;return o>0?Object.assign(Object.assign({},e),{[i]:[...e[i]||[],t[n]]}):Object.assign(Object.assign({},e),{[i]:t[n]})}),{}))}},this.save=e=>{const t=e&&Bt(e);t?this.store.set(t):this.store.remove(),this.set(t),this.root.onSetFilter()},this.filter=e=>{if(!this.data)return{visible:e,hidden:0};const t=this.data.filter,n=t.ratingRange&&t.ratingRange.split("-").map((e=>parseInt(e,10))),o=[],i=[];let s,r=0;return e.forEach((e=>{var a,c,l,d;if(s=e.variant,"cancel"===e.action)i.push(e);else if(!(null===(a=t.variant)||void 0===a?void 0:a.includes(s))||!(null===(c=t.speed)||void 0===c?void 0:c.includes((e.s||1).toString()))||1==(null===(l=t.mode)||void 0===l?void 0:l.length)&&t.mode[0]!=(e.ra||0).toString()||1==(null===(d=t.increment)||void 0===d?void 0:d.length)&&t.increment[0]!=e.i.toString()||n&&(!e.rating||e.rating<n[0]||e.rating>n[1]))r++;else{const t=e.ra+s+e.t+e.rating;o.includes(t)||i.push(e),o.push(t)}})),{visible:i,hidden:r}},this.store=Rt(e),this.set(this.store.get())}}function Ft(e,t,n,o=!0){return function(e){return{insert:t=>e(t.elm)}}((i=>i.addEventListener(e,(e=>{const o=t(e);return!1===o&&e.preventDefault(),null==n||n(),o}),{passive:o})))}function Kt(e){Kt.close();const t=$('<div id="modal-wrap"><span class="close" role="button" aria-label="Close" data-icon="" tabindex="0"></span></div>'),n=$(`<div id="modal-overlay" class="${e.class}">`);return e.noClickAway||n.on("click",Kt.close),$('<a href="#"></a>').appendTo(n),t.appendTo(n),$('<a href="#"></a>').appendTo(n),e.content.clone().removeClass("none").appendTo(t),e.onInsert&&e.onInsert(t),Kt.onClose=e.onClose,t.find(".close,.cancel").each((function(){qt(this,Kt.close)})),$("body").addClass("overlayed").prepend(n),zt(t),t}Kt.close=()=>{$("body").removeClass("overlayed"),$("#modal-overlay").each((function(){Kt.onClose&&Kt.onClose(),$(this).remove()})),delete Kt.onClose},Kt.onClose=void 0;const qt=(e,t)=>{e.addEventListener("click",t),e.addEventListener("keydown",(e=>"Enter"!==e.code&&"Space"!==e.code||t()))},zt=e=>{e.on("click",(e=>e.stopPropagation())),Wt(e)},Wt=e=>{var t,n;const o=e.find('button:not(:disabled), [href], input:not(:disabled):not([type="hidden"]), select:not(:disabled), textarea:not(:disabled), [tabindex="0"]');null===(n=null!==(t=o[1])&&void 0!==t?t:o[0])||void 0===n||n.focus()};class Vt{constructor(e,t){this.makeStorage=e,this.root=t,this.save=e=>this.stores[e.getAttribute("data-type")].set(Bt(e)),this.sliderTimes=[0,1/4,.5,3/4,1,1.5,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,25,30,35,40,45,60,75,90,105,120,135,150,165,180],this.sliderTime=e=>e<this.sliderTimes.length?this.sliderTimes[e]:180,this.sliderIncrement=e=>{if(e<=20)return e;switch(e){case 21:return 25;case 22:return 30;case 23:return 35;case 24:return 40;case 25:return 45;case 26:return 60;case 27:return 90;case 28:return 120;case 29:return 150;default:return 180}},this.sliderDays=e=>{if(e<=3)return e;switch(e){case 4:return 5;case 5:return 7;case 6:return 10;default:return 14}},this.sliderInitVal=(e,t,n)=>{for(let o=0;o<n;o++)if(t(o)===e)return o},this.hookToPoolMember=(e,t)=>{const n=Array.from(new FormData(t).entries()),o={};for(const r in n)o[n[r][0]]=n[r][1];const i="random"==e&&1==o.variant&&1==o.mode&&1==o.timeMode,s=parseFloat(o.time)+"+"+parseInt(o.increment);return i&&this.root.pools.find((e=>e.id===s))?{id:s,range:o.ratingRange}:void 0},this.prepareForm=e=>{const t=this,n=e.find("form"),o=n.find("#sf_timeMode"),i=n.find(".mode_choice"),r=i.find("input"),a=r.eq(0),c=r.eq(1),l=n.find("#sf_variant"),d=n.find(".fen_position"),u=d.find("input"),h=!!u.val(),p=n.find(".time_choice [name=time]"),f=n.find(".increment_choice [name=increment]"),g=n.find(".days_choice [name=days]"),m=n.data("type"),v=e.find(".ratings > div"),b=n.data("random-color-variants").split(","),k=n.find(".color-submits__button"),w=()=>{const e=l.val(),t=o.val(),n=parseFloat(p.val()),i=parseFloat(f.val()),s="hook"===m&&"0"===t||"1"!=e&&("1"!=t||n<.5&&0==i||0==n&&i<2);let r=c.prop("checked");s&&r&&(a.prop("checked",!0),y(),r=!1),c.prop("disabled",!!s).siblings("label").toggleClass("disabled",s);const d="1"!=t||n>0||i>0,h="ai"!=m||"3"!=e||n>=1||"1"!=t,g="3"!==e||u.hasClass("success"),v=(e,t)=>e.prop("disabled",t).toggleClass("disabled",t);d&&h&&g?(v(k,!1),r&&b.includes(e)&&v(k.filter(":not(.random)"),!0)):v(k,!0)},y=()=>this.save(n[0]),C=this.stores[m].get();C&&Object.keys(C).forEach((e=>{n.find(`[name="${e}"]`).each((function(){"timeMode"===e&&n.data("forceTimeMode")||("checkbox"==this.type?this.checked=!0:"radio"==this.type?this.checked=this.value==C[e]:"fen"==e&&this.value||(this.value=C[e]))}))}));const T=()=>{const t=o.val();let n="correspondence";switch(l.val()){case"1":case"3":if("1"==t){const e=60*parseFloat(p.val())+40*parseFloat(f.val());n=e<30?"ultraBullet":e<180?"bullet":e<480?"blitz":e<1500?"rapid":"classical"}break;case"10":n="crazyhouse";break;case"2":n="chess960";break;case"4":n="kingOfTheHill";break;case"5":n="threeCheck";break;case"6":n="antichess";break;case"7":n="atomic";break;case"8":n="horde";break;case"9":n="racingKings"}const i=v.hide().filter("."+n).show();e.find(".ratings input").val(i.find("strong").text()),y()};if("hook"==m){n.data("anon")&&o.val("1").children(".timeMode_2, .timeMode_0").prop("disabled",!0).attr("title",this.root.trans("youNeedAnAccountToDoThat"));const t=t=>{const i=n[0],r=parseInt(e.find(".ratings input").val())||1500;i.ratingRange&&(i.ratingRange.value=[r+parseInt(i.ratingRange_range_min.value),r+parseInt(i.ratingRange_range_max.value)].join("-")),y();const a=this.hookToPoolMember(t,i);return Kt.close(),a?this.root.enterPool(a):(this.root.setTab("1"===o.val()?"real_time":"seeks"),s(n.attr("action").replace(/sri-placeholder/,lichess.sri),{method:"post",body:(()=>{const e=new FormData(n[0]);return e.append("color",t),e})()})),this.root.redraw(),!1};k.on("click",(function(){return t($(this).val())})).prop("disabled",!1),n.on("submit",(()=>t("random")))}else n.one("submit",(()=>{k.hide(),n.find(".color-submits").append(lichess.spinnerHtml)}));this.root.opts.blindMode?(l[0].focus(),p.add(f).on("change",(()=>{w(),T()}))):(p.add(f).each((function(){const e=$(this),n=e.siblings("span"),o=e.siblings(".range"),i=e.parent().hasClass("time_choice"),s=e=>{return n.text(i?(t=e)==1/4?"¼":.5==t?"½":t==3/4?"¾":""+t:""+e);var t};s(parseFloat(e.val())),o.attr({min:"0",max:""+(i?38:30),value:""+t.sliderInitVal(parseFloat(e.val()),i?t.sliderTime:t.sliderIncrement,100)}),o.on("input",(()=>{const n=(r=parseInt(o.val()),(i?t.sliderTime:t.sliderIncrement)(r));var r;s(n),e.val(""+n),T(),w()}))})),g.each((function(){const e=$(this),n=e.siblings("span"),o=e.siblings(".range");n.text(e.val()),o.attr({min:"1",max:"7",value:""+t.sliderInitVal(parseInt(e.val()),t.sliderDays,20)}),o.on("input",(()=>{const i=t.sliderDays(parseInt(o.val()));n.text(""+i),e.val(""+i),y()}))})),n.find(".rating-range").each((function(){const e=$(this),n=e.find(".rating-range__min"),o=e.find(".rating-range__max"),i=t.makeStorage("lobby.ratingRange.min"),s=t.makeStorage("lobby.ratingRange.max"),r=t=>{const r=n.val(),a=o.val();i.set(r),s.set(a),e.find(".rating-min").text(`-${r.replace("-","")}`),e.find(".rating-max").text(`+${a}`),t&&y()};n.attr({min:"-500",max:"0",step:"50",value:i.get()||"-500"}).on("input",r),o.attr({min:"0",max:"500",step:"50",value:s.get()||"500"}).on("input",r),r()}))),o.on("change",(function(){const e=$(this).val();n.find(".time_choice, .increment_choice").toggle("1"==e),n.find(".days_choice").toggle("2"==e),w(),T()})).trigger("change");const x=function(e,t,n=!1){let o,i=0;return function(...s){const r=this;o&&clearTimeout(o),o=void 0;const a=performance.now()-i;i=performance.now(),n&&a>t?e.apply(r,s):o=setTimeout((()=>{o=void 0,e.apply(r,s)}),t)}}((()=>{u.removeClass("success failure");const e=u.val();if(e){const[t,n]=u.parent().data("validate-url").split("?");s(((e,t)=>{const n=new URLSearchParams;for(const i of Object.keys(t))void 0!==t[i]&&n.append(i,t[i]);const o=n.toString();return o?`${e}?${o}`:e})(t,{fen:e})+(n?`&${n}`:"")).then((t=>{u.addClass("success"),d.find(".preview").html(t),d.find("a.board_editor").each((function(){this.href=this.href.replace(/editor\/.+$/,"editor/"+e)})),w(),lichess.contentLoaded()}),(e=>{u.addClass("failure"),d.find(".preview").html(""),w()}))}}),200);u.on("keyup",x),h&&l.val("3"),l.on("change",(function(){const e="3"==$(this).val();d.toggle(e),i.toggle(!e),e&&(a.trigger("click"),x(),requestAnimationFrame((()=>document.body.dispatchEvent(new Event("chessground.resize"))))),T(),w()})).trigger("change"),r.on("change",y),n.find("div.level").each((function(){const e=$(this).find(".ai_info > div");$(this).find("label").on("mouseenter",(function(){e.hide().filter("."+$(this).attr("for")).show()})),$(this).find("#config_level").on("mouseleave",(function(){const t=$(this).find("input:checked").val();e.hide().filter(".sf_level_"+t).show()})).trigger("mouseout"),$(this).find("input").on("change",y)}))},this.stores={hook:Rt(e("lobby.setup.hook")),friend:Rt(e("lobby.setup.friend")),ai:Rt(e("lobby.setup.ai"))}}}class Gt{constructor(e,t){var n,o,s;this.opts=e,this.redraw=t,this.stepHooks=[],this.stepping=!1,this.redirecting=!1,this.alreadyWatching=[],this.flushHooks=e=>{this.flushHooksTimeout&&clearTimeout(this.flushHooksTimeout),e?this.doFlushHooks():(this.stepping=!0,"real_time"===this.tab&&this.redraw(),setTimeout((()=>{this.stepping=!1,this.doFlushHooks()}),500)),this.flushHooksTimeout=this.flushHooksSchedule()},this.flushHooksSchedule=()=>setTimeout(this.flushHooks,8e3),this.setTab=e=>{e!==this.tab&&("seeks"===e?Ht().then(this.setSeeks):"real_time"===e?this.socket.realTimeIn():"real_time"===this.tab&&(this.socket.realTimeOut(),this.data.hooks=[]),this.tab=this.stores.tab.set(e)),this.filter.open=!1},this.setMode=e=>{this.mode=this.stores.mode.set(e),this.filter.open=!1},this.setSort=e=>{this.sort=this.stores.sort.set(e)},this.onSetFilter=()=>{this.flushHooks(!0),"real_time"!==this.tab&&this.redraw()},this.clickHook=e=>{const t=function(e,t){return e.data.hooks.find((e=>e.id===t))}(this,e);!t||t.disabled||this.stepping||this.redirecting||("cancel"===t.action||yt(t.variant))&&this.socket.send(t.action,t.id)},this.clickSeek=e=>{const t=function(e,t){return e.data.seeks.find((e=>e.id===t))}(this,e);t&&!this.redirecting&&("cancelSeek"===t.action||yt(t.variant))&&this.socket.send(t.action,t.id)},this.setSeeks=e=>{this.data.seeks=e,Pt(this),this.redraw()},this.clickPool=e=>{var t;this.data.me?this.poolMember&&this.poolMember.id===e?this.leavePool():(this.enterPool({id:e}),this.redraw()):(t=this.pools.find((t=>t.id==e)),i("/setup/hook/"+lichess.sri,{method:"POST",body:a({variant:1,timeMode:1,time:t.lim,increment:t.inc,days:1,color:"random"})}),this.setTab("real_time"))},this.enterPool=e=>{!function(e,t){const n=Nt(e);t?lichess.storage.set(n,t):lichess.storage.remove(n)}(e.id,e.range),this.setTab("pools"),this.poolMember=e,this.poolIn()},this.leavePool=()=>{this.poolMember&&(this.socket.poolOut(this.poolMember),this.poolMember=void 0,this.redraw())},this.poolIn=()=>{this.poolMember&&(this.poolInStorage.fire(),this.socket.poolIn(this.poolMember))},this.gameActivity=e=>{this.data.nowPlaying.find((t=>t.gameId===e))&&i("/account/now-playing").then((e=>e.nowPlaying)).then((e=>{this.data.nowPlaying=e,this.startWatching(),this.redraw()}))},this.setRedirecting=()=>{this.redirecting=!0,setTimeout((()=>{this.redirecting=!1,this.redraw()}),4e3),this.redraw()},this.awake=()=>{switch(this.tab){case"real_time":this.data.hooks=[],this.socket.realTimeIn();break;case"seeks":Ht().then(this.setSeeks)}},this.data=e.data,this.data.hooks=[],this.pools=e.pools,this.playban=e.playban,this.isBot=!!(null===(n=e.data.me)||void 0===n?void 0:n.isBot),this.filter=new Dt(lichess.storage.make("lobby.filter"),this),this.setup=new Vt(lichess.storage.make,this),St(this),Pt(this),this.socket=new Et(e.socketSend,this),this.stores=(s=null===(o=this.data.me)||void 0===o?void 0:o.username.toLowerCase(),{tab:It(At,s),mode:It($t,s),sort:It(Ot,s)}),this.tab=this.isBot?"now_playing":this.stores.tab.get(),this.mode=this.stores.mode.get(),this.sort=this.stores.sort.get(),this.trans=e.trans,this.poolInStorage=lichess.storage.make("lobby.pool-in"),this.poolInStorage.listen((e=>{this.leavePool(),t()})),this.flushHooksSchedule(),this.startWatching(),this.playban?this.playban.remainingSecond<86400&&setTimeout(lichess.reload,1e3*this.playban.remainingSeconds):(setInterval((()=>{this.poolMember?this.poolIn():"real_time"!==this.tab||this.data.hooks.length||this.socket.realTimeIn()}),1e4),this.joinPoolFromLocationHash()),lichess.pubsub.on("socket.open",(()=>{"real_time"===this.tab?(this.data.hooks=[],this.socket.realTimeIn()):"pools"===this.tab&&this.poolMember&&this.poolIn()})),window.addEventListener("beforeunload",(()=>{this.poolMember&&this.socket.poolOut(this.poolMember)}))}doFlushHooks(){this.stepHooks=this.data.hooks.slice(0),"real_time"===this.tab&&this.redraw()}startWatching(){const e=this.data.nowPlaying.map((e=>e.gameId)).filter((e=>!this.alreadyWatching.includes(e)));e.length&&(setTimeout((()=>this.socket.send("startWatching",e.join(" "))),2e3),e.forEach((e=>this.alreadyWatching.push(e))))}joinPoolFromLocationHash(){if(location.hash.startsWith("#pool/")){const t=/^#pool\/(\d+\+\d+)(?:\/(.+))?$/.exec(location.hash),n={id:t[1],blocking:t[2]},o=(e=n.id,lichess.storage.get(Nt(e)));o&&(n.range=o),t&&(this.setTab("pools"),this.data.me?this.enterPool(n):setTimeout((()=>this.clickPool(n.id)),1500),history.replaceState(null,"","/"))}var e}}const Ut=[{"stroke-width":3.779,d:"m21.78 12.64c-1.284 8.436 8.943 12.7 14.54 17.61 3 2.632 4.412 4.442 5.684 7.93"},{"stroke-width":4.157,d:"m43.19 36.32c2.817-1.203 6.659-5.482 5.441-7.623-2.251-3.957-8.883-14.69-11.89-19.73-0.4217-0.7079-0.2431-1.835 0.5931-3.3 1.358-2.38 1.956-5.628 1.956-5.628"},{"stroke-width":4.535,d:"m37.45 2.178s-3.946 0.6463-6.237 2.234c-0.5998 0.4156-2.696 0.7984-3.896 0.6388-17.64-2.345-29.61 14.08-25.23 27.34 4.377 13.26 22.54 25.36 39.74 8.666"}];function Xt(){return k("div.spinner",{"aria-label":"loading"},[k("svg",{attrs:{viewBox:"-2 -2 54 54"}},[k("g",{attrs:{mask:"url(#mask)",fill:"none",stroke:"#888","stroke-dasharray":1}},Ut.map((e=>k("path",{attrs:Object.assign({pathLength:1},e)}))))])])}function Yt(e,t,n,o){return k("span",{class:{active:t===n,glowing:t!==n&&"pools"===t&&!!e.poolMember},hook:Ft("mousedown",(n=>e.setTab(t)),e.redraw)},o)}function Zt(e){const t=e.data.nbNowPlaying,n=e.data.nowPlaying.filter((e=>e.isMyTurn)).length,o=e.tab;return[e.isBot?void 0:Yt(e,"pools",o,[e.trans.noarg("quickPairing")]),e.isBot?void 0:Yt(e,"real_time",o,[e.trans.noarg("lobby")]),e.isBot?void 0:Yt(e,"seeks",o,[e.trans.noarg("correspondence")]),"now_playing"===o||t||e.isBot?Yt(e,"now_playing",o,[...e.trans.vdomPlural("nbGamesInPlay",t,t>=100?"100+":t.toString()),n>0?k("i.unread",n>=9?"9+":n):null]):null]}function Jt(e){return Ft("click",(t=>{const n=t.target.getAttribute("data-id")||t.target.parentNode.getAttribute("data-id");"custom"===n?$(".config_hook").trigger("mousedown"):n&&e.clickPool(n)}),e.redraw)}function Qt(e){return e.map((function(e){return k("td",[e])}))}const en={ultraBullet:"UltraBullet",bullet:"Bullet",blitz:"Blitz",rapid:"Rapid",classical:"Classical",correspondence:"Correspondence",racingKings:"Racing Kings",threeCheck:"Three-check",antichess:"Antichess",horde:"Horde",atomic:"Atomic",crazyhouse:"Crazyhouse",chess960:"Chess960",kingOfTheHill:"King of the Hill"},tn={ultraBullet:"",bullet:"",blitz:"",rapid:"",classical:"",correspondence:"",chess960:"",kingOfTheHill:"",antichess:"",atomic:"",threeCheck:"",horde:"",racingKings:"",crazyhouse:""};function nn(e){return function(t){return"standard"===t.variant===e}}function on(e){return"cancel"===e.action}function sn(e){return!on(e)}function rn(e,t){const n=t.find(on),o=n?13:14,i=t.slice(0,o),s=t=>function(e,t){const n=e.trans.noarg;return k("tr.hook."+t.action,{key:t.id,class:{disabled:!!t.disabled},attrs:{title:t.disabled?"":"join"===t.action?n("joinTheGame")+" | "+en[t.perf]:n("cancel"),"data-id":t.id}},Qt([k("span.is.is2.color-icon."+(t.c||"random")),t.rating?k("span.ulink.ulpt",{attrs:{"data-href":"/@/"+t.u}},t.u):n("anonymous"),(t.rating?t.rating:"")+(t.prov?"?":""),t.clock,k("span",{attrs:{"data-icon":tn[t.perf]}},n(t.ra?"rated":"casual"))]))}(e,t),r=i.filter(sn).filter(nn(!0));xt(e,r);const a=i.filter(sn).filter(nn(!1)).slice(0,Math.max(0,o-r.length-1));xt(e,a);const c=[...r.map(s),a.length?k("tr.variants",{key:"variants"},[k("td",{attrs:{colspan:5}},"— "+e.trans("variant")+" —")]):null,...a.map(s)];return n&&c.unshift(s(n)),k("table.hooks__list",[k("thead",k("tr",[k("th"),k("th",e.trans("player")),k("th",{class:{sortable:!0,sort:"rating"===e.sort},hook:Ft("click",(t=>e.setSort("rating")),e.redraw)},[k("i.is"),e.trans("rating")]),k("th",{class:{sortable:!0,sort:"time"===e.sort},hook:Ft("click",(t=>e.setSort("time")),e.redraw)},[k("i.is"),e.trans("time")]),k("th",e.trans("mode"))])),k("tbody",{class:{stepping:e.stepping},hook:Ft("click",(t=>{let n=t.target;do{if(n=n.parentNode,"TR"===n.nodeName)return e.clickHook(n.getAttribute("data-id"))}while("TABLE"!==n.nodeName)}),e.redraw)},c)])}const an=e=>e+"%",cn=e=>Math.log(e/150+1);function ln(e){const t=Math.max(1e3,Math.min(2200,e||1500));let n;const o=.4;return n=1500==t?o:t>1500?o+cn(t-1500)/cn(1300)*2*o:o-cn(1500-t)/cn(500)*o,Math.round(94*n)}const dn=2e3,un=e=>{const t=e=>Math.log((e-30)/200+1);return Math.round(t(Math.min(dn,e||dn))/t(dn)*100)};function hn(e,t){const n=Math.max(0,ln(t.rating)-2),o=Math.max(0,un(t.t)-2);return k("span#"+[t.id,"plot.new",t.ra?"rated":"casual","cancel"===t.action?"cancel":""].join("."),{key:t.id,attrs:{"data-icon":tn[t.perf],style:`bottom:${an(n)};left:${an(o)}`},hook:{insert(n){$(n.elm).powerTip({placement:t.rating&&t.rating>1800?"se":"ne",closeDelay:200,popupId:"hook",preRender(){$("#hook").html(function(e,t){const n=t.c||"random";let o='<div class="inner">';t.rating?(o+='<a class="opponent ulpt is color-icon '+n+'" href="/@/'+t.u+'">',o+=" "+t.u+" ("+t.rating+(t.prov?"?":"")+")",o+="</a>"):o+='<span class="opponent anon '+n+'">'+e.trans("anonymous")+"</span>";return o+='<div class="inner-clickable">',o+=`<div>${t.clock}</div>`,o+='<i data-icon="'+tn[t.perf]+'"> '+e.trans(t.ra?"rated":"casual")+"</i>",o+="</div></div>",o}(e,t)).find(".inner-clickable").on("click",(()=>e.clickHook(t.id)))}}),setTimeout((function(){n.elm.classList.remove("new")}),20)},destroy(e){$.powerTip.hide(e.elm,!0),$.powerTip.destroy(e.elm)}}})}const pn=[1,2,3,5,7,10,15,20,30];function fn(){const e=[];return pn.forEach((t=>{const n=un(60*t);e.push(k("span.x.label",{attrs:{style:"left:"+an(n-1.5)}},""+t)),e.push(k("div.grid.vert",{attrs:{style:"width:"+an(n)}}))})),e}const gn=[1e3,1200,1400,1500,1600,1800,2e3];function mn(){const e=[];return gn.forEach((function(t){const n=ln(t);e.push(k("span.y.label",{attrs:{style:"bottom:"+an(n+1)}},""+t)),e.push(k("div.grid.horiz",{attrs:{style:"height:"+an(n+.8)}}))})),e}const vn=e=>k("div.hook__filters",{hook:{insert(t){const n=t.elm;n.filterLoaded||(lichess.loadCssPath("lobby.setup"),s("/setup/filter").then((t=>{n.innerHTML=t,n.filterLoaded=!0,function(e,t){var n;const o=null===(n=e.filter.data)||void 0===n?void 0:n.form,i=$(t),s=i.find(".rating-range"),r=s.find('input[name="ratingRange"]'),a=s.find(".rating-range__min"),c=s.find(".rating-range__max");o?Object.keys(o).forEach((e=>{const t=i.find(`input[name="${e}"]`)[0];t&&("checkbox"==t.type?t.checked=!0:t.value=o[e])})):i.find("input").prop("checked",!0);const l=()=>e.filter.save(i.find("form")[0]);function d(e){a.attr("max",c.val()),c.attr("min",a.val());const t=a.val()+"-"+c.val();r.val(t),s.siblings(".range").text(t),e&&l()}i.find("input").on("change",l),i.find("form").on("reset",(t=>{t.preventDefault(),e.filter.save(null),e.filter.open=!1,e.redraw()})).on("submit",(t=>{t.preventDefault(),e.filter.open=!1,e.redraw()}));const u=r.val()?r.val().split("-"):[];a.attr({step:"50",value:u[0]||a.attr("min")}).on("input",d),c.attr({step:"50",value:u[1]||c.attr("max")}).on("input",d),d()}(e,n)})))}}});function bn(e){let t,n,o,i,s;switch(e.filter.open&&(t=vn(e)),e.mode){case"chart":s=e.filter.filter(e.data.hooks),o=s.hidden,n=t||function(e,t){return k("div.hooks__chart",[k("div.canvas",{hook:Ft("click",(t=>{t.target.classList.contains("plot")&&e.clickHook(t.target.id)}),e.redraw)},t.map((t=>hn(e,t)))),...mn(),...fn()])}(e,s.visible),i=e.filter.open?null:function(e){return k("i.toggle",{key:"set-mode-list",attrs:{title:e.trans.noarg("list"),"data-icon":""},hook:Ft("mousedown",(t=>e.setMode("list")),e.redraw)})}(e);break;default:s=e.filter.filter(e.stepHooks),o=s.hidden,n=t||rn(e,s.visible),i=e.filter.open?null:function(e){return k("i.toggle",{key:"set-mode-chart",attrs:{title:e.trans.noarg("graph"),"data-icon":""},hook:Ft("mousedown",(t=>e.setMode("chart")),e.redraw)})}(e)}return[function(e,t){const n=e.filter;return k("i.toggle.toggle-filter",{class:{gamesFiltered:t>0,active:n.open},hook:Ft("mousedown",n.toggle,e.redraw),attrs:{"data-icon":n.open?"":"",title:e.trans.noarg("filterGames")}})}(e,o),i,n]}function kn(e){if(e.data.me&&e.data.seeks.length<8)return k("div.create",[k("a.button",{hook:Ft("click",(()=>{$(".lobby__start .config_hook").each((function(){this.dataset.hrefAddon="?time=correspondence"})).trigger("mousedown").trigger("click")}))},e.trans("createAGame"))])}function wn(e){return[k("table.hooks__list",[k("thead",[k("tr",["","player","rating","time","mode"].map((t=>k("th",e.trans(t)))))]),k("tbody",{hook:Ft("click",(t=>{let n=t.target;do{if(n=n.parentNode,"TR"===n.nodeName)return e.data.me?e.clickSeek(n.getAttribute("data-id")):void(confirm(e.trans("youNeedAnAccountToDoThat"))&&(location.href="/signup"))}while("TABLE"!==n.nodeName)}))},e.data.seeks.map((t=>function(e,t){const n="joinSeek"===t.action?"join":"cancel",o=e.trans.noarg;return k("tr.seek."+n,{key:t.id,attrs:{title:"joinSeek"===t.action?o("joinTheGame")+" - "+en[t.perf.key]:o("cancel"),"data-id":t.id}},Qt([k("span.is.is2.color-icon."+(t.color||"random")),t.rating?k("span.ulpt",{attrs:{"data-href":"/@/"+t.username}},t.username):"Anonymous",t.rating+(t.provisional?"?":""),t.days?e.trans.plural("nbDays",t.days):"∞",k("span",[k("span.varicon",{attrs:{"data-icon":tn[t.perf.key]}}),o(1===t.mode?"rated":"casual")])]))}(e,t))))]),kn(e)]}function yn(e){const t=Date.now()+1e3*e.secondsLeft;return k("time.timeago",{hook:{insert(e){e.elm.setAttribute("datetime",""+t)}}},lichess.timeago(t))}function Cn(e){let t,n={};if(e.redirecting)t=Xt();else switch(e.tab){case"pools":t=function(e){const t=e.poolMember;return e.pools.map((e=>{const n=!!t&&t.id===e.id;return k("div",{class:{active:n,transp:!n&&!!t&&!n},attrs:{"data-id":e.id}},[k("div.clock",e.lim+"+"+e.inc),n&&t.range?(o=t.range,k("div.range",o.replace("-","–"))):k("div.perf",e.perf),n?Xt():null]);var o})).concat(k("div.custom",{class:{transp:!!t},attrs:{"data-id":"custom"}},e.trans.noarg("custom")))}(e),n={hook:Jt(e)};break;case"real_time":t=bn(e);break;case"seeks":t=wn(e);break;case"now_playing":t=function(e){return k("div.now-playing",e.data.nowPlaying.map((t=>k("a."+t.variant.key,{key:`${t.gameId}${t.lastMove}`,attrs:{href:"/"+t.fullId}},[k("span.mini-board.cg-wrap.is2d",{attrs:{"data-state":`${t.fen},${t.color},${t.lastMove}`},hook:{insert(e){lichess.miniBoard.init(e.elm)}}}),k("span.meta",[t.opponent.ai?e.trans("aiNameLevelAiLevel","Stockfish",t.opponent.ai):t.opponent.username,k("span.indicator",t.isMyTurn?t.secondsLeft&&t.hasMoved?yn(t):[e.trans.noarg("yourTurn")]:k("span"," "))])]))))}(e)}return k("div.lobby__app.lobby__app-"+e.tab,[k("div.tabs-horiz",Zt(e)),k("div.lobby__app__content.l"+(e.redirecting?"redir":e.tab),n,t)])}const Tn=function(e,t){let n,o;const i={create:[],update:[],remove:[],destroy:[],pre:[],post:[]},s=void 0!==t?t:c;for(n=0;n<v.length;++n)for(i[v[n]]=[],o=0;o<e.length;++o){const t=e[o][v[n]];void 0!==t&&i[v[n]].push(t)}function r(e){const t=e.id?"#"+e.id:"",n=e.getAttribute("class"),o=n?"."+n.split(" ").join("."):"";return l(s.tagName(e).toLowerCase()+t+o,{},[],void 0,e)}function a(e,t){return function(){if(0==--t){const t=s.parentNode(e);s.removeChild(t,e)}}}function b(e,t){var n,o;let r,a=e.data;if(void 0!==a){const t=null===(n=a.hook)||void 0===n?void 0:n.init;p(t)&&(t(e),a=e.data)}const c=e.children,l=e.sel;if("!"===l)h(e.text)&&(e.text=""),e.elm=s.createComment(e.text);else if(void 0!==l){const n=l.indexOf("#"),h=l.indexOf(".",n),g=n>0?n:l.length,m=h>0?h:l.length,v=-1!==n||-1!==h?l.slice(0,Math.min(g,m)):l,k=e.elm=p(a)&&p(r=a.ns)?s.createElementNS(r,v,a):s.createElement(v,a);for(g<m&&k.setAttribute("id",l.slice(g+1,m)),h>0&&k.setAttribute("class",l.slice(m+1).replace(/\./g," ")),r=0;r<i.create.length;++r)i.create[r](f,e);if(d(c))for(r=0;r<c.length;++r){const e=c[r];null!=e&&s.appendChild(k,b(e,t))}else u(e.text)&&s.appendChild(k,s.createTextNode(e.text));const w=e.data.hook;p(w)&&(null===(o=w.create)||void 0===o||o.call(w,f,e),w.insert&&t.push(e))}else e.elm=s.createTextNode(e.text);return e.elm}function k(e,t,n,o,i,r){for(;o<=i;++o){const i=n[o];null!=i&&s.insertBefore(e,b(i,r),t)}}function w(e){var t,n;const o=e.data;if(void 0!==o){null===(n=null===(t=null==o?void 0:o.hook)||void 0===t?void 0:t.destroy)||void 0===n||n.call(t,e);for(let t=0;t<i.destroy.length;++t)i.destroy[t](e);if(void 0!==e.children)for(let t=0;t<e.children.length;++t){const n=e.children[t];null!=n&&"string"!=typeof n&&w(n)}}}function y(e,t,n,o){for(var r,c;n<=o;++n){let o,l;const d=t[n];if(null!=d)if(p(d.sel)){w(d),o=i.remove.length+1,l=a(d.elm,o);for(let t=0;t<i.remove.length;++t)i.remove[t](d,l);const e=null===(c=null===(r=null==d?void 0:d.data)||void 0===r?void 0:r.hook)||void 0===c?void 0:c.remove;p(e)?e(d,l):l()}else s.removeChild(e,d.elm)}}function C(e,t,n){var o,r,a,c,l;const d=null===(o=t.data)||void 0===o?void 0:o.hook;null===(r=null==d?void 0:d.prepatch)||void 0===r||r.call(d,e,t);const u=t.elm=e.elm,f=e.children,v=t.children;if(e!==t){if(void 0!==t.data){for(let n=0;n<i.update.length;++n)i.update[n](e,t);null===(c=null===(a=t.data.hook)||void 0===a?void 0:a.update)||void 0===c||c.call(a,e,t)}h(t.text)?p(f)&&p(v)?f!==v&&function(e,t,n,o){let i,r,a,c,l=0,d=0,u=t.length-1,p=t[0],f=t[u],v=n.length-1,w=n[0],T=n[v];for(;l<=u&&d<=v;)null==p?p=t[++l]:null==f?f=t[--u]:null==w?w=n[++d]:null==T?T=n[--v]:g(p,w)?(C(p,w,o),p=t[++l],w=n[++d]):g(f,T)?(C(f,T,o),f=t[--u],T=n[--v]):g(p,T)?(C(p,T,o),s.insertBefore(e,p.elm,s.nextSibling(f.elm)),p=t[++l],T=n[--v]):g(f,w)?(C(f,w,o),s.insertBefore(e,f.elm,p.elm),f=t[--u],w=n[++d]):(void 0===i&&(i=m(t,l,u)),r=i[w.key],h(r)?s.insertBefore(e,b(w,o),p.elm):(a=t[r],a.sel!==w.sel?s.insertBefore(e,b(w,o),p.elm):(C(a,w,o),t[r]=void 0,s.insertBefore(e,a.elm,p.elm))),w=n[++d]);(l<=u||d<=v)&&(l>u?(c=null==n[v+1]?null:n[v+1].elm,k(e,c,n,d,v,o)):y(e,t,l,u))}(u,f,v,n):p(v)?(p(e.text)&&s.setTextContent(u,""),k(u,null,v,0,v.length-1,n)):p(f)?y(u,f,0,f.length-1):p(e.text)&&s.setTextContent(u,""):e.text!==t.text&&(p(f)&&y(u,f,0,f.length-1),s.setTextContent(u,t.text)),null===(l=null==d?void 0:d.postpatch)||void 0===l||l.call(d,e,t)}}return function(e,t){let n,o,a;const c=[];for(n=0;n<i.pre.length;++n)i.pre[n]();for(function(e){return void 0!==e.sel}(e)||(e=r(e)),g(e,t)?C(e,t,c):(o=e.elm,a=s.parentNode(o),b(t,c),null!==a&&(s.insertBefore(a,t.elm,s.nextSibling(o)),y(a,[e],0,0))),n=0;n<c.length;++n)c[n].data.hook.insert(c[n]);for(n=0;n<i.post.length;++n)i.post[n]();return t}}([T,y]);window.Chessground=function(e,t){const n={pieces:be(ge),orientation:"white",turnColor:"white",coordinates:!0,autoCastle:!0,viewOnly:!1,disableContextMenu:!1,addPieceZIndex:!1,addDimensionsCssVars:!1,blockTouchScroll:!1,pieceKey:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15}},pieces:{baseUrl:"https://lichess1.org/assets/piece/cburnett/"},prevSvgHash:""},hold:L()};function o(){const t="dom"in n?n.dom.unbind:void 0,o=function(e,t){e.innerHTML="",e.classList.add("cg-wrap");for(const a of x)e.classList.toggle("orientation-"+a,t.orientation===a);e.classList.toggle("manipulable",!t.viewOnly);const n=K("cg-container");e.appendChild(n);const o=K("cg-board");let i,s,r;if(n.appendChild(o),t.drawable.visible&&(i=Qe(We("svg"),{class:"cg-shapes",viewBox:"-4 -4 8 8",preserveAspectRatio:"xMidYMid slice"}),i.appendChild(We("defs")),i.appendChild(We("g")),s=Qe(We("svg"),{class:"cg-custom-svgs",viewBox:"-3.5 -3.5 8 8",preserveAspectRatio:"xMidYMid slice"}),s.appendChild(We("g")),n.appendChild(i),n.appendChild(s)),t.coordinates){const e="black"===t.orientation?" black":"";n.appendChild(st(S,"ranks"+e)),n.appendChild(st(M,"files"+e))}return t.draggable.showGhost&&(r=K("piece","ghost"),R(r,!1),n.appendChild(r)),{board:o,container:n,wrap:e,ghost:r,svg:i,customSvg:s}}(e,n),i=function(e){let t;const n=()=>(void 0===t&&(t=e()),t);return n.clear=()=>{t=void 0},n}((()=>o.board.getBoundingClientRect())),s=e=>{lt(a),!e&&o.svg&&Ve(a,o.svg,o.customSvg)},r=()=>{dt(a),function(e){const t=fe(e),n=E(e.dom.bounds());let o=e.dom.elements.board.firstChild;for(;o;)(ut(o)&&!o.cgAnimating||ht(o))&&B(o,n(O(o.cgKey),t)),o=o.nextSibling}(a)},a=n;return a.dom={elements:o,bounds:i,redraw:bt(s),redrawNow:s,unbind:t},a.drawable.prevSvgHash="",dt(a),s(!1),rt(a,r),t||(a.dom.unbind=function(e,t){const n=[];if("ResizeObserver"in window||n.push(at(document.body,"chessground.resize",t)),!e.viewOnly){const t=ct(e,Be,Oe),o=ct(e,Re,Ie);for(const e of["touchmove","mousemove"])n.push(at(document,e,t));for(const e of["touchend","mouseup"])n.push(at(document,e,o));const i=()=>e.dom.bounds.clear();n.push(at(document,"scroll",i,{capture:!0,passive:!0})),n.push(at(window,"resize",i,{passive:!0}))}return()=>n.forEach((e=>e()))}(a,r)),a.events.insert&&a.events.insert(o),a}return we(n,t||{}),ze(o(),o)};let xn=!1;function Mn(e,t){const n=document.querySelector(e);let o=parseInt(n.getAttribute("data-count"));const i=(e,o,i)=>{var s;n.textContent=(s=Math.round((e*(t-1-i)+o*(i+1))/t),!1===xn&&(xn=window.Intl&&Intl.NumberFormat?new Intl.NumberFormat:null),null===xn?""+s:xn.format(s))};let s=[];return(e,r)=>{if(!n||!e&&0!==e)return;r&&(t=Math.abs(r)),s.forEach(clearTimeout),s=[];const a=Math.abs(lichess.socket.pingInterval()/t),c=o||e;o=e;for(let n=0;n<t;n++)s.push(setTimeout((()=>i(c,e,n)),Math.round(n*a)))}}return function(e){e.element=document.querySelector(".lobby__app"),e.pools=[{id:"1+0",lim:1,inc:0,perf:"Bullet"},{id:"2+1",lim:2,inc:1,perf:"Bullet"},{id:"3+0",lim:3,inc:0,perf:"Blitz"},{id:"3+2",lim:3,inc:2,perf:"Blitz"},{id:"5+0",lim:5,inc:0,perf:"Blitz"},{id:"5+3",lim:5,inc:3,perf:"Blitz"},{id:"10+0",lim:10,inc:0,perf:"Rapid"},{id:"10+5",lim:10,inc:5,perf:"Rapid"},{id:"15+10",lim:15,inc:10,perf:"Rapid"},{id:"30+0",lim:30,inc:0,perf:"Classical"},{id:"30+20",lim:30,inc:20,perf:"Classical"}];const o=Mn("#nb_games_in_play > strong",8),i=Mn("#nb_connected_players > strong",10);lichess.socket=new lichess.StrongSocket("/lobby/socket/v5",!1,{receive(e,t){r.socketReceive(e,t)},events:{n(e,t){i(t.d),setTimeout((()=>o(t.r)),lichess.socket.pingInterval()/2)},reload_timeline(){s("/timeline").then((e=>{$(".timeline").html(e),lichess.contentLoaded()}))},featured(e){$(".lobby__tv").html(e.html),lichess.contentLoaded()},redirect(e){r.leavePool(),r.setRedirecting(),lichess.redirect(e)},fen(e){r.gameActivity(e.id)}}}),lichess.StrongSocket.firstConnect.then((()=>{var e;const t=(e=>{const t=RegExp("[?&]"+e+"=([^&]*)").exec(location.search);return t&&decodeURIComponent(t[1].replace(/\+/g," "))})("hook_like");if(!t)return;const n=null===(e=r.setup.stores.hook.get())||void 0===e?void 0:e.ratingRange;s(`/setup/hook/${lichess.sri}/like/${t}?rr=${n||""}`,{method:"post"}),r.setTab("real_time"),history.replaceState(null,"","/")})),e.blindMode=$("body").hasClass("blind-mode"),e.trans=lichess.trans(e.i18n),e.socketSend=lichess.socket.send;const r=function(e){const t=new Gt(e,(function(){o=Tn(o,Cn(t))})),n=Cn(t);e.element.innerHTML="";let o=Tn(e.element,n);return{socketReceive:t.socket.receive,setTab(e){t.setTab(e),t.redraw()},gameActivity:t.gameActivity,setRedirecting:t.setRedirecting,enterPool:t.enterPool,leavePool:t.leavePool,setup:t.setup,redraw:t.redraw}}(e),a=$(".lobby__start"),c=e.blindMode?"click":"mousedown";a.find("a:not(.disabled)").on(c,(function(){$(this).addClass("active").siblings().removeClass("active"),lichess.loadCssPath("lobby.setup"),r.leavePool();let e=this.href;this.dataset.hrefAddon&&(e+=this.dataset.hrefAddon,delete this.dataset.hrefAddon),fetch(e,Object.assign(Object.assign({},t),{headers:n})).then((e=>e.text().then((t=>{e.ok?(r.setup.prepareForm(Kt({content:$(t),class:"game-setup",onClose(){a.find(".active").removeClass("active")}})),lichess.contentLoaded()):(alert(t),lichess.reload())}))))})).on("click",(e=>e.preventDefault())),["#ai","#friend","#hook"].includes(location.hash)&&(a.find(".config_"+location.hash.replace("#","")).each((function(){this.dataset.hrefAddon=location.search})).trigger(c),"#hook"===location.hash&&(/time=realTime/.test(location.search)?r.setTab("real_time"):/time=correspondence/.test(location.search)&&r.setTab("seeks")),history.replaceState(null,"","/")),function(){const e=window.matchMedia("(prefers-color-scheme: dark)");if("not all"==e.media)return;const t=document.body.getAttribute("data-theme");if(e.matches==("dark"==t))return;let n;const o=()=>(n=n||lichess.loadModule("dasher").then((()=>window.LichessDasher(document.createElement("div"),{playing:!1}))),n);$(".bg-switch").addClass("active").on("click",(()=>o().then((e=>e.subs.background.set(document.body.classList.contains("dark")?"light":"dark")))))}()}}();
