var LichessNotify=function(){"use strict";const t={createElement:function(t,e){return document.createElement(t,e)},createElementNS:function(t,e,n){return document.createElementNS(t,e,n)},createTextNode:function(t){return document.createTextNode(t)},createComment:function(t){return document.createComment(t)},insertBefore:function(t,e,n){t.insertBefore(e,n)},removeChild:function(t,e){t.removeChild(e)},appendChild:function(t,e){t.appendChild(e)},parentNode:function(t){return t.parentNode},nextSibling:function(t){return t.nextSibling},tagName:function(t){return t.tagName},setTextContent:function(t,e){t.textContent=e},getTextContent:function(t){return t.textContent},isElement:function(t){return 1===t.nodeType},isText:function(t){return 3===t.nodeType},isComment:function(t){return 8===t.nodeType}};function e(t,e,n,o,i){return{sel:t,data:e,children:n,text:o,elm:i,key:void 0===e?void 0:e.key}}const n=Array.isArray;function o(t){return"string"==typeof t||"number"==typeof t}function i(t){return void 0===t}function r(t){return void 0!==t}const s=e("",{},[],void 0,void 0);function a(t,e){var n,o;const i=t.key===e.key,r=(null===(n=t.data)||void 0===n?void 0:n.is)===(null===(o=e.data)||void 0===o?void 0:o.is);return t.sel===e.sel&&i&&r}function c(t,e,n){var o;const i={};for(let r=e;r<=n;++r){const e=null===(o=t[r])||void 0===o?void 0:o.key;void 0!==e&&(i[e]=r)}return i}const l=["create","update","remove","destroy","pre","post"];function d(t,e,n){if(t.ns="http://www.w3.org/2000/svg","foreignObject"!==n&&void 0!==e)for(let o=0;o<e.length;++o){const t=e[o].data;void 0!==t&&d(t,e[o].children,e[o].sel)}}function u(t,i,r){let s,a,c,l={};if(void 0!==r?(null!==i&&(l=i),n(r)?s=r:o(r)?a=r:r&&r.sel&&(s=[r])):null!=i&&(n(i)?s=i:o(i)?a=i:i&&i.sel?s=[i]:l=i),void 0!==s)for(c=0;c<s.length;++c)o(s[c])&&(s[c]=e(void 0,void 0,void 0,s[c],void 0));return"s"!==t[0]||"v"!==t[1]||"g"!==t[2]||3!==t.length&&"."!==t[3]&&"#"!==t[3]||d(l,s,t),e(t,l,s,a,void 0)}function p(t,e){let n;const o=e.elm;let i=t.data.attrs,r=e.data.attrs;if((i||r)&&i!==r){for(n in i=i||{},r=r||{},r){const t=r[n];i[n]!==t&&(!0===t?o.setAttribute(n,""):!1===t?o.removeAttribute(n):120!==n.charCodeAt(0)?o.setAttribute(n,t):58===n.charCodeAt(3)?o.setAttributeNS("http://www.w3.org/XML/1998/namespace",n,t):58===n.charCodeAt(5)?o.setAttributeNS("http://www.w3.org/1999/xlink",n,t):o.setAttribute(n,t))}for(n in i)n in r||o.removeAttribute(n)}}function f(t,e){let n,o;const i=e.elm;let r=t.data.class,s=e.data.class;if((r||s)&&r!==s){for(o in r=r||{},s=s||{},r)r[o]&&!Object.prototype.hasOwnProperty.call(s,o)&&i.classList.remove(o);for(o in s)n=s[o],n!==r[o]&&i.classList[n?"add":"remove"](o)}}const g={Accept:"application/vnd.lichess.v5+json"},m={cache:"no-cache",credentials:"same-origin"},h={"X-Requested-With":"XMLHttpRequest"};function v(t){if(t.ok)return t;if(429==t.status)throw new Error("Too many requests");if(413==t.status)throw new Error("The uploaded file is too large");throw new Error(`Error ${t.status}`)}const x=(t,e={})=>fetch(t,Object.assign(Object.assign(Object.assign({},m),{headers:Object.assign({},h)}),e));let w=[],b=!1;function y(t){const e=lichess.storage.make("just-notified");if(document.hasFocus()||Date.now()-parseInt(e.get(),10)<1e3)return;e.set(""+Date.now()),$.isFunction(t)&&(t=t());const n=new Notification("lichess.org",{icon:lichess.assetUrl("logo/lichess-favicon-256.png",{noVersion:!0}),body:t});n.onclick=()=>window.focus(),w.push(n),b||(b=!0,window.addEventListener("focus",(()=>{w.forEach((t=>t.close())),w=[]})))}const k=[{"stroke-width":3.779,d:"m21.78 12.64c-1.284 8.436 8.943 12.7 14.54 17.61 3 2.632 4.412 4.442 5.684 7.93"},{"stroke-width":4.157,d:"m43.19 36.32c2.817-1.203 6.659-5.482 5.441-7.623-2.251-3.957-8.883-14.69-11.89-19.73-0.4217-0.7079-0.2431-1.835 0.5931-3.3 1.358-2.38 1.956-5.628 1.956-5.628"},{"stroke-width":4.535,d:"m37.45 2.178s-3.946 0.6463-6.237 2.234c-0.5998 0.4156-2.696 0.7984-3.896 0.6388-17.64-2.345-29.61 14.08-25.23 27.34 4.377 13.26 22.54 25.36 39.74 8.666"}];function P(t){return{genericLink:{html:t=>C(t,t.content.url,t.content.icon,[u("span",[u("strong",t.content.title),N(t)]),u("span",t.content.text)]),text:t=>t.content.title||t.content.text},mention:{html:e=>C(e,"/forum/redirect/post/"+e.content.postId,"",[u("span",[u("strong",T(e.content.mentionedBy)),N(e)]),u("span",t("mentionedYouInX",e.content.topic))]),text:e=>t("xMentionedYouInY",T(e.content.mentionedBy),e.content.topic)},invitedStudy:{html:e=>C(e,"/study/"+e.content.studyId,"",[u("span",[u("strong",T(e.content.invitedBy)),N(e)]),u("span",t("invitedYouToX",e.content.studyName))]),text:e=>t("xInvitedYouToY",T(e.content.invitedBy),e.content.studyName)},privateMessage:{html:t=>C(t,"/inbox/"+t.content.user.name,"",[u("span",[u("strong",T(t.content.user)),N(t)]),u("span",t.content.text)]),text:t=>T(t.content.sender)+": "+t.content.text},teamJoined:{html:e=>C(e,"/team/"+e.content.id,"",[u("span",[u("strong",e.content.name),N(e)]),u("span",t.noarg("youAreNowPartOfTeam"))]),text:e=>t("youHaveJoinedTeamX",e.content.name)},titledTourney:{html:t=>C(t,"/tournament/"+t.content.id,"",[u("span",[u("strong","Lichess Titled Arena"),N(t)]),u("span",t.content.text)]),text:t=>"Lichess Titled Arena"},reportedBanned:{html:e=>C(e,void 0,"",[u("span",[u("strong",t.noarg("someoneYouReportedWasBanned"))]),u("span",t.noarg("thankYou"))]),text:e=>t.noarg("someoneYouReportedWasBanned")},gameEnd:{html:e=>{let n;switch(e.content.win){case!0:n=t.noarg("congratsYouWon");break;case!1:n=t.noarg("defeat");break;default:n=t.noarg("draw")}return C(e,"/"+e.content.id,"",[u("span",[u("strong",t("gameVsX",T(e.content.opponent))),N(e)]),u("span",n)])},text:e=>{let n;switch(e.content.win){case!0:n=t.noarg("victory");break;case!1:n=t.noarg("defeat");break;default:n=t.noarg("draw")}return t("resVsX",n,T(e.content.opponent))}},planStart:{html:t=>C(t,"/patron","",[u("span",[u("strong","You just became a lichess Patron."),N(t)])]),text:t=>"You just became a lichess Patron."},planExpire:{html:t=>C(t,"/patron","",[u("span",[u("strong","Patron account expired"),N(t)])]),text:t=>"Patron account expired"},coachReview:{html:e=>C(e,"/coach/edit","",[u("span",[u("strong","New pending review"),N(e)]),u("span",t.noarg("someoneReviewedYourCoachProfile"))]),text:e=>t.noarg("newPendingReview")},ratingRefund:{html:e=>C(e,"/player/myself","",[u("span",[u("strong",t.noarg("lostAgainstTOSViolator")),N(e)]),u("span",t("refundXpointsTimeControlY",e.content.points,e.content.perf))]),text:e=>t("refundXpointsTimeControlY",e.content.points,e.content.perf)},corresAlarm:{html:e=>C(e,"/"+e.content.id,"",[u("span",[u("strong",t.noarg("timeAlmostUp")),N(e)]),u("span",t("gameVsX",e.content.op))]),text:e=>t.noarg("timeAlmostUp")},irwinDone:{html:t=>C(t,"/@/"+t.content.user.name+"?mod","",[u("span",[u("strong",T(t.content.user)),N(t)]),u("span","Irwin job complete!")]),text:t=>t.content.user.name+": Irwin job complete!"}}}function C(t,e,n,o){return u(e?"a":"span",{class:{site_notification:!0,[t.type]:!0,new:!t.read},attrs:e?{href:e}:void 0},[u("i",{attrs:{"data-icon":n}}),u("span.content",o)])}function N(t){const e=new Date(t.date);return u("time.timeago",{attrs:{title:e.toLocaleString(),datetime:t.date}},lichess.timeago(e))}function T(t){return t?t.title?t.title+" "+t.name:t.name:"Anonymous"}function A(t){const e=t.data();return u("div#notify-app.links.dropdown",e&&!t.initiating()?function(t,e){const n=e.pager,o=n.currentPageResults.length,i=[];n.previousPage?i.push(u("div.pager.prev",{attrs:{"data-icon":""},hook:j(t.previousPage)})):n.nextPage&&i.push(u("div.pager.prev.disabled",{attrs:{"data-icon":""}}));o>0&&1==n.currentPage&&i.push(u("div.clear",u("button.delete.button.button-empty",{attrs:{"data-icon":"",title:"Clear"},hook:j(t.clear)})));i.push(o?function(t,e){const n=lichess.trans(t.i18n);return u("div",{class:{notifications:!0,scrolling:e},hook:{insert:B,postpatch:B}},t.pager.currentPageResults.map((t=>function(t,e){const n=P(e);return n[t.type]?n[t.type].html(t):void 0}(t,n))))}(e,t.scrolling()):function(){return u("div.empty.text",{attrs:{"data-icon":""}},"No notifications.")}()),n.nextPage&&i.push(u("div.pager.next",{attrs:{"data-icon":""},hook:j(t.nextPage)}));"Notification"in window?"denied"==Notification.permission&&i.push(u("a.browser-notification.denied",{attrs:{href:"/faq#browser-notifications",target:"_blank",rel:"noopener"}},"Notification popups disabled by browser setting")):i.push(u("div.browser-notification","Browser does not support notification popups"));return i}(t,e):[u("div.initiating",u("div.spinner",{"aria-label":"loading"},[u("svg",{attrs:{viewBox:"-2 -2 54 54"}},[u("g",{attrs:{mask:"url(#mask)",fill:"none",stroke:"#888","stroke-dasharray":1}},k.map((t=>u("path",{attrs:Object.assign({pathLength:1},t)}))))])]))])}function j(t){return{insert:e=>{e.elm.addEventListener("click",t)}}}const B=t=>lichess.contentLoaded(t.elm);function O(t,e){let n,o=!0,i=!1;const r=lichess.storage.make("notify-read-all");function s(s,a){n=s,1===n.pager.currentPage&&n.unread&&t.isVisible()&&(t.setNotified(),n.unread=0,r.fire()),o=!1,i=!1,t.setCount(n.unread),a&&function(){if(!n||1!==n.pager.currentPage)return;const e=n.pager.currentPageResults.find((t=>!t.read));if(!e)return;t.pulse(),lichess.quietMode&&"lichess"!=e.content.user.id||lichess.sound.play("newPM");const o=function(t,e){const n=P(e);return n[t.type]?n[t.type].text(t):void 0}(e,lichess.trans(n.i18n));parseInt(lichess.storage.get("push-subscribed")||"0",10)+864e5>=Date.now()||!o||(i=o,!document.hasFocus()&&"Notification"in window&&"granted"===Notification.permission&&setTimeout(y,10+500*Math.random(),i));var i}(),e()}r.listen((o=>{n&&(n.unread=0,t.setCount(0),e())}));const a=t=>((t,e={})=>fetch(t,Object.assign(Object.assign(Object.assign({},m),{headers:Object.assign(Object.assign({},g),h)}),e)).then((t=>v(t).json())))(((t,e)=>{const n=new URLSearchParams;for(const i of Object.keys(e))void 0!==e[i]&&n.append(i,e[i]);const o=n.toString();return o?`${t}?${o}`:t})("/notify",{page:t||1})).then((t=>s(t,!1)),(t=>lichess.announce({msg:"Failed to load notifications"})));const c={pager:{currentPage:1,maxPerPage:1,currentPageResults:[],nbResults:0,nbPages:1},unread:0,i18n:{}};return{data:()=>n,initiating:()=>o,scrolling:()=>i,update:s,nextPage:function(){n&&n.pager.nextPage&&(i=!0,a(n.pager.nextPage),e())},previousPage:function(){n&&n.pager.previousPage&&(i=!0,a(n.pager.previousPage),e())},loadPage:a,setVisible:function(){n&&1!==n.pager.currentPage||a(1)},setMsgRead:function(e){n&&n.pager.currentPageResults.forEach((o=>{"privateMessage"!=o.type||o.content.user.id!=e||o.read||(o.read=!0,n.unread=Math.max(0,n.unread-1),t.setCount(n.unread))}))},clear:function(){((t,e={})=>x(t,e).then((t=>v(t).text())))("/notify/clear",{method:"post"}).then((t=>s(c,!1)),(t=>lichess.announce({msg:"Failed to clear notifications"})))}}}const R=function(d,u){let p,f;const g={create:[],update:[],remove:[],destroy:[],pre:[],post:[]},m=void 0!==u?u:t;for(p=0;p<l.length;++p)for(g[l[p]]=[],f=0;f<d.length;++f){const t=d[f][l[p]];void 0!==t&&g[l[p]].push(t)}function h(t){const n=t.id?"#"+t.id:"",o=t.getAttribute("class"),i=o?"."+o.split(" ").join("."):"";return e(m.tagName(t).toLowerCase()+n+i,{},[],void 0,t)}function v(t,e){return function(){if(0==--e){const e=m.parentNode(t);m.removeChild(e,t)}}}function x(t,e){var a,c;let l,d=t.data;if(void 0!==d){const e=null===(a=d.hook)||void 0===a?void 0:a.init;r(e)&&(e(t),d=t.data)}const u=t.children,p=t.sel;if("!"===p)i(t.text)&&(t.text=""),t.elm=m.createComment(t.text);else if(void 0!==p){const i=p.indexOf("#"),a=p.indexOf(".",i),f=i>0?i:p.length,h=a>0?a:p.length,v=-1!==i||-1!==a?p.slice(0,Math.min(f,h)):p,w=t.elm=r(d)&&r(l=d.ns)?m.createElementNS(l,v,d):m.createElement(v,d);for(f<h&&w.setAttribute("id",p.slice(f+1,h)),a>0&&w.setAttribute("class",p.slice(h+1).replace(/\./g," ")),l=0;l<g.create.length;++l)g.create[l](s,t);if(n(u))for(l=0;l<u.length;++l){const t=u[l];null!=t&&m.appendChild(w,x(t,e))}else o(t.text)&&m.appendChild(w,m.createTextNode(t.text));const b=t.data.hook;r(b)&&(null===(c=b.create)||void 0===c||c.call(b,s,t),b.insert&&e.push(t))}else t.elm=m.createTextNode(t.text);return t.elm}function w(t,e,n,o,i,r){for(;o<=i;++o){const i=n[o];null!=i&&m.insertBefore(t,x(i,r),e)}}function b(t){var e,n;const o=t.data;if(void 0!==o){null===(n=null===(e=null==o?void 0:o.hook)||void 0===e?void 0:e.destroy)||void 0===n||n.call(e,t);for(let e=0;e<g.destroy.length;++e)g.destroy[e](t);if(void 0!==t.children)for(let e=0;e<t.children.length;++e){const n=t.children[e];null!=n&&"string"!=typeof n&&b(n)}}}function y(t,e,n,o){for(var i,s;n<=o;++n){let o,a;const c=e[n];if(null!=c)if(r(c.sel)){b(c),o=g.remove.length+1,a=v(c.elm,o);for(let e=0;e<g.remove.length;++e)g.remove[e](c,a);const t=null===(s=null===(i=null==c?void 0:c.data)||void 0===i?void 0:i.hook)||void 0===s?void 0:s.remove;r(t)?t(c,a):a()}else m.removeChild(t,c.elm)}}function k(t,e,n){var o,s,l,d,u;const p=null===(o=e.data)||void 0===o?void 0:o.hook;null===(s=null==p?void 0:p.prepatch)||void 0===s||s.call(p,t,e);const f=e.elm=t.elm,h=t.children,v=e.children;if(t!==e){if(void 0!==e.data){for(let n=0;n<g.update.length;++n)g.update[n](t,e);null===(d=null===(l=e.data.hook)||void 0===l?void 0:l.update)||void 0===d||d.call(l,t,e)}i(e.text)?r(h)&&r(v)?h!==v&&function(t,e,n,o){let r,s,l,d,u=0,p=0,f=e.length-1,g=e[0],h=e[f],v=n.length-1,b=n[0],P=n[v];for(;u<=f&&p<=v;)null==g?g=e[++u]:null==h?h=e[--f]:null==b?b=n[++p]:null==P?P=n[--v]:a(g,b)?(k(g,b,o),g=e[++u],b=n[++p]):a(h,P)?(k(h,P,o),h=e[--f],P=n[--v]):a(g,P)?(k(g,P,o),m.insertBefore(t,g.elm,m.nextSibling(h.elm)),g=e[++u],P=n[--v]):a(h,b)?(k(h,b,o),m.insertBefore(t,h.elm,g.elm),h=e[--f],b=n[++p]):(void 0===r&&(r=c(e,u,f)),s=r[b.key],i(s)?m.insertBefore(t,x(b,o),g.elm):(l=e[s],l.sel!==b.sel?m.insertBefore(t,x(b,o),g.elm):(k(l,b,o),e[s]=void 0,m.insertBefore(t,l.elm,g.elm))),b=n[++p]);(u<=f||p<=v)&&(u>f?(d=null==n[v+1]?null:n[v+1].elm,w(t,d,n,p,v,o)):y(t,e,u,f))}(f,h,v,n):r(v)?(r(t.text)&&m.setTextContent(f,""),w(f,null,v,0,v.length-1,n)):r(h)?y(f,h,0,h.length-1):r(t.text)&&m.setTextContent(f,""):t.text!==e.text&&(r(h)&&y(f,h,0,h.length-1),m.setTextContent(f,e.text)),null===(u=null==p?void 0:p.postpatch)||void 0===u||u.call(p,t,e)}}return function(t,e){let n,o,i;const r=[];for(n=0;n<g.pre.length;++n)g.pre[n]();for(function(t){return void 0!==t.sel}(t)||(t=h(t)),a(t,e)?k(t,e,r):(o=t.elm,i=m.parentNode(o),x(e,r),null!==i&&(m.insertBefore(i,e.elm,m.nextSibling(o)),y(i,[t],0,0))),n=0;n<r.length;++n)r[n].data.hook.insert(r[n]);for(n=0;n<g.post.length;++n)g.post[n]();return e}}([{create:f,update:f},{create:p,update:p}]);return function(t,e){const n=O(e,i);let o=R(t,A(n));function i(){o=R(o,A(n))}return e.data?n.update(e.data,e.incoming):n.loadPage(1),{update:n.update,setVisible:n.setVisible,setMsgRead:n.setMsgRead,redraw:i}}}();
